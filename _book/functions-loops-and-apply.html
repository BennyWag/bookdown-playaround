<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Functions, loops, and apply | Intro to R for Forest Ecosystem Science</title>
  <meta name="description" content="Introductory R" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Functions, loops, and apply | Intro to R for Forest Ecosystem Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Introductory R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Functions, loops, and apply | Intro to R for Forest Ecosystem Science" />
  
  <meta name="twitter:description" content="Introductory R" />
  

<meta name="author" content="Anu Singh, Benjamin Wagner, and Kaitlyn Hammond" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="extracting-raster-fractions-and-area-using-a-polygon-mask.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><i class="fa fa-check"></i><b>2</b> <code>dplyr</code> - A brief introduction to tidy data manipulation</a><ul>
<li class="chapter" data-level="2.1" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#introducing-the-koala-dataset"><i class="fa fa-check"></i><b>2.1</b> Introducing the koala dataset</a></li>
<li class="chapter" data-level="2.2" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#working-with-dplyr"><i class="fa fa-check"></i><b>2.2</b> Working with <code>dplyr</code></a><ul>
<li class="chapter" data-level="2.2.1" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#select-and-dplyrs-pipe"><i class="fa fa-check"></i><b>2.2.1</b> select() and dplyr’s pipe</a></li>
<li class="chapter" data-level="2.2.2" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#filter"><i class="fa fa-check"></i><b>2.2.2</b> filter()</a></li>
<li class="chapter" data-level="2.2.3" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-1"><i class="fa fa-check"></i><b>2.2.3</b> Challenge 1</a></li>
<li class="chapter" data-level="2.2.4" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#group_by-and-summarise"><i class="fa fa-check"></i><b>2.2.4</b> group_by() and summarise()</a></li>
<li class="chapter" data-level="2.2.5" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-2"><i class="fa fa-check"></i><b>2.2.5</b> Challenge 2</a></li>
<li class="chapter" data-level="2.2.6" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#mutate"><i class="fa fa-check"></i><b>2.2.6</b> mutate()</a></li>
<li class="chapter" data-level="2.2.7" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-3"><i class="fa fa-check"></i><b>2.2.7</b> Challenge 3</a></li>
<li class="chapter" data-level="2.2.8" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#solution-to-all-challenges"><i class="fa fa-check"></i><b>2.2.8</b> Solution to all challenges</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html"><i class="fa fa-check"></i><b>3</b> Working with spatial data in <code>R</code></a><ul>
<li class="chapter" data-level="3.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#transforming-a-dataset-into-an-sf-object"><i class="fa fa-check"></i><b>3.1</b> Transforming a dataset into an <code>sf</code> object</a></li>
<li class="chapter" data-level="3.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#loading-shapefiles-into-r-transforming-and-plotting"><i class="fa fa-check"></i><b>3.2</b> Loading shapefiles into <code>R</code>, transforming and plotting</a><ul>
<li class="chapter" data-level="3.2.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#challenge-1-2"><i class="fa fa-check"></i><b>3.2.1</b> Challenge 1</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#simple-geometric-operations"><i class="fa fa-check"></i><b>3.3</b> Simple geometric operations</a></li>
<li class="chapter" data-level="3.4" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#making-a-map-using-ggplot2"><i class="fa fa-check"></i><b>3.4</b> Making a map using <code>ggplot2</code></a><ul>
<li class="chapter" data-level="3.4.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#challenge-2-2"><i class="fa fa-check"></i><b>3.4.1</b> Challenge 2</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#r-raster-basics"><i class="fa fa-check"></i><b>3.5</b> <code>R</code> raster basics</a></li>
<li class="chapter" data-level="3.6" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#plotting-rasters-in-ggplot2"><i class="fa fa-check"></i><b>3.6</b> Plotting rasters in <code>ggplot2</code></a><ul>
<li class="chapter" data-level="3.6.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#challenge-3-2"><i class="fa fa-check"></i><b>3.6.1</b> Challenge 3</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#solutions-to-challenges"><i class="fa fa-check"></i><b>3.7</b> Solutions to Challenges</a><ul>
<li class="chapter" data-level="3.7.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#challenge-1-3"><i class="fa fa-check"></i><b>3.7.1</b> Challenge 1</a></li>
<li class="chapter" data-level="3.7.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#challenge-2-3"><i class="fa fa-check"></i><b>3.7.2</b> Challenge 2</a></li>
<li class="chapter" data-level="3.7.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#challenge-3-3"><i class="fa fa-check"></i><b>3.7.3</b> Challenge 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html"><i class="fa fa-check"></i><b>4</b> Calculating class area from raster</a><ul>
<li class="chapter" data-level="4.1" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html#simple-area-and-area-fraction-calculations-on-a-classified-raster"><i class="fa fa-check"></i><b>4.1</b> Simple area and area fraction calculations on a classified raster</a><ul>
<li class="chapter" data-level="4.1.1" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html#creating-dummy-data"><i class="fa fa-check"></i><b>4.1.1</b> Creating dummy data</a></li>
<li class="chapter" data-level="4.1.2" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html#preparing-the-raster-for-area-calculation"><i class="fa fa-check"></i><b>4.1.2</b> Preparing the raster for area calculation</a></li>
<li class="chapter" data-level="4.1.3" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html#compiling-a-comprehensive-table"><i class="fa fa-check"></i><b>4.1.3</b> Compiling a comprehensive table</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><i class="fa fa-check"></i><b>5</b> Extracting raster fractions and area using a polygon mask</a><ul>
<li class="chapter" data-level="5.1" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#problem-statement"><i class="fa fa-check"></i><b>5.1</b> Problem statement</a></li>
<li class="chapter" data-level="5.2" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#creating-some-dummy-raster-data"><i class="fa fa-check"></i><b>5.2</b> Creating some dummy raster data</a></li>
<li class="chapter" data-level="5.3" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#create-some-reserves"><i class="fa fa-check"></i><b>5.3</b> Create some reserves</a></li>
<li class="chapter" data-level="5.4" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#extracting-data"><i class="fa fa-check"></i><b>5.4</b> Extracting data</a></li>
<li class="chapter" data-level="5.5" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#plotting-the-results"><i class="fa fa-check"></i><b>5.5</b> Plotting the results</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html"><i class="fa fa-check"></i><b>6</b> Functions, loops, and <code>apply</code></a><ul>
<li class="chapter" data-level="6.1" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#introduction-1"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#writing-basic-functions"><i class="fa fa-check"></i><b>6.2</b> Writing basic functions</a></li>
<li class="chapter" data-level="6.3" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#using-apply-functions"><i class="fa fa-check"></i><b>6.3</b> Using <code>apply</code> functions</a><ul>
<li class="chapter" data-level="6.3.1" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#apply"><i class="fa fa-check"></i><b>6.3.1</b> <code>apply</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#sapply"><i class="fa fa-check"></i><b>6.3.2</b> <code>sapply</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#lapply"><i class="fa fa-check"></i><b>6.3.3</b> <code>lapply</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#mapply"><i class="fa fa-check"></i><b>6.3.4</b> <code>mapply</code></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#loops"><i class="fa fa-check"></i><b>6.4</b> Loops</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro to R for Forest Ecosystem Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions-loops-and-apply" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Functions, loops, and <code>apply</code></h1>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">6.1</span> Introduction</h2>
<p>Most data analysis in R requires executing a particular task on multiple data observations, groups of observations, or separate data sets. Many novice users begin with the strategy of assigning a new variable for each input:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" title="1">x1 &lt;-<span class="st"> </span>dataset1</a>
<a class="sourceLine" id="cb126-2" title="2">x2 &lt;-<span class="st"> </span>dataset2</a>
<a class="sourceLine" id="cb126-3" title="3"></a>
<a class="sourceLine" id="cb126-4" title="4">meanx1 &lt;-<span class="st"> </span><span class="kw">mean</span>(x1)</a>
<a class="sourceLine" id="cb126-5" title="5">meanx2 &lt;-<span class="st"> </span><span class="kw">mean</span>(x2)</a></code></pre></div>
<p>While this certainly works, it can be very time consuming and introduces substantial risk of user error. There are several alternative strategies that can be used to repeat mathematical operations or sequences of R functions for multiple variables or data sets that avoid this risk.</p>
<p>The foundation for any of these strategies is a function to be repeated. Once you have a function that you would like to repeat on multiple inputs, there are a few approaches for iterating through each repetition.</p>
<p>In this tutorial, we will focus on the <code>apply</code> functions, which are a set of base R functions that can be used to execute a particular chunk of code on multiple inputs and generate appropriate outputs. The <code>apply</code> functions are simple to use and create very neat code, but one limitation is that they can only be used in operations for which the order of iteration is not important.</p>
<p>We will also introduce <code>for</code> and <code>while</code> loops, which can be used when the order of operations <em>does</em> matter.</p>
</div>
<div id="writing-basic-functions" class="section level2">
<h2><span class="header-section-number">6.2</span> Writing basic functions</h2>
<p>Functions in R take an input value, apply a process, and generate an output. R packages include numerous functions that can do nearly anything you desire, but research often requires specific processes or sequences of commands designed specifically to work with your data structure. You can write your own functions in R to perform these tasks.</p>
<p>Here is a very simple function:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" title="1">fun1 &lt;-<span class="st"> </span><span class="cf">function</span> (x, y){</a>
<a class="sourceLine" id="cb127-2" title="2">  x <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb127-3" title="3">}</a></code></pre></div>
<p>Here, <code>x</code> and <code>y</code> are identified as the required input variables. The code written within the brackets describes the mathematical operation to be applied to the input variables.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" title="1"><span class="kw">fun1</span>(<span class="dt">x =</span> <span class="dv">7</span>, <span class="dt">y =</span> <span class="dv">12</span>)</a></code></pre></div>
<pre><code>## [1] 19</code></pre>
<p>A function can be applied to a vector of inputs. In this scenario, the function will be applied to each pair of values in the vector sequence:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" title="1">vals_x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb130-2" title="2">vals_y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb130-3" title="3"></a>
<a class="sourceLine" id="cb130-4" title="4"><span class="kw">fun1</span>(<span class="dt">x =</span> vals_x, <span class="dt">y =</span> vals_y)</a></code></pre></div>
<pre><code>## [1] 6 8 4</code></pre>
<div id="nesting-functions" class="section level4">
<h4><span class="header-section-number">6.2.0.1</span> Nesting functions</h4>
<p>Functions can also include other functions, which is particularly useful in the context of repeating complex data analyses. Here is a basic example:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" title="1">fun2 &lt;-<span class="st"> </span><span class="cf">function</span> (x, y){</a>
<a class="sourceLine" id="cb132-2" title="2">  <span class="kw">mean</span>(x) <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb132-3" title="3">}</a>
<a class="sourceLine" id="cb132-4" title="4"></a>
<a class="sourceLine" id="cb132-5" title="5"></a>
<a class="sourceLine" id="cb132-6" title="6"><span class="kw">fun2</span>(<span class="dt">x =</span> vals_x, <span class="dt">y =</span> vals_y)</a></code></pre></div>
<pre><code>## [1] 6 5 7</code></pre>
<p>It is important to note that in this situation, the internal function (<code>mean()</code>) takes a vector of input values. This function will calculate the mean of the <code>vals_x</code> vector and then add this to each separate value of <code>vals_y</code>.</p>
<p>This can be very useful, but it’s critical that you know exactly how your function processes input values or you may run into major problems!</p>
</div>
<div id="assigning-variables-within-functions-and-return" class="section level4">
<h4><span class="header-section-number">6.2.0.2</span> Assigning variables within functions and <code>return()</code></h4>
<p>In some more complex analyses, the nested functions may generate data that needs to be stored as variables so they can be used as input for the next process. Here is a function that calculates the mean of our x values, adds y, and then generates 10 numbers from a normal distribution with a mean of the value calculated in the first step.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1">fun3 &lt;-<span class="st"> </span><span class="cf">function</span> (x, y){</a>
<a class="sourceLine" id="cb134-2" title="2">  val &lt;-<span class="st"> </span><span class="kw">mean</span>(x) <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb134-3" title="3">  dist &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">mean =</span> val, <span class="dt">sd =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb134-4" title="4">}</a>
<a class="sourceLine" id="cb134-5" title="5"></a>
<a class="sourceLine" id="cb134-6" title="6"></a>
<a class="sourceLine" id="cb134-7" title="7">output &lt;-<span class="st"> </span><span class="kw">fun3</span>(<span class="dt">x =</span> vals_x, <span class="dt">y =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb134-8" title="8">output</a></code></pre></div>
<pre><code>##  [1] 7.006171 8.065973 6.424325 7.342045 6.372207 5.439520 6.166673
##  [8] 7.498010 7.504085 7.408942</code></pre>
<p>If your function assigns multiple variables, you can use <code>return()</code> to determine the data that is output from the function. This can be useful if your function includes writing a data set, or includes another process that is not intended to return anything to R as well as some process intended to return data to the R environment.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" title="1"><span class="co">#Let&#39;s see what happens without using the return() function</span></a>
<a class="sourceLine" id="cb136-2" title="2">fun4 &lt;-<span class="st"> </span><span class="cf">function</span> (x, y){</a>
<a class="sourceLine" id="cb136-3" title="3">  val &lt;-<span class="st"> </span><span class="kw">mean</span>(x) <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb136-4" title="4">  dist &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">mean =</span> x, <span class="dt">sd =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb136-5" title="5">  <span class="kw">write.csv</span>(dist, <span class="st">&quot;filename.csv&quot;</span>)</a>
<a class="sourceLine" id="cb136-6" title="6">}</a>
<a class="sourceLine" id="cb136-7" title="7"></a>
<a class="sourceLine" id="cb136-8" title="8"></a>
<a class="sourceLine" id="cb136-9" title="9">output &lt;-<span class="st"> </span><span class="kw">fun4</span>(<span class="dt">x =</span> vals_x, <span class="dt">y =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb136-10" title="10">output</a></code></pre></div>
<pre><code>## NULL</code></pre>
<p>Our output here is NULL because the default output for a function will come from the last command within the function. Here, <code>write.csv()</code> does not produce data to be returned to R. If we add <code>return()</code>, our function will write the .csv and also return the data we want into the environment:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" title="1"><span class="co">#Now let&#39;s add return()</span></a>
<a class="sourceLine" id="cb138-2" title="2">fun4 &lt;-<span class="st"> </span><span class="cf">function</span> (x, y){</a>
<a class="sourceLine" id="cb138-3" title="3">  val &lt;-<span class="st"> </span><span class="kw">mean</span>(x) <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb138-4" title="4">  dist &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">mean =</span> x, <span class="dt">sd =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb138-5" title="5">  <span class="kw">write.csv</span>(dist, <span class="st">&quot;filename.csv&quot;</span>)</a>
<a class="sourceLine" id="cb138-6" title="6">  <span class="kw">return</span>(dist)</a>
<a class="sourceLine" id="cb138-7" title="7">}</a>
<a class="sourceLine" id="cb138-8" title="8"></a>
<a class="sourceLine" id="cb138-9" title="9"></a>
<a class="sourceLine" id="cb138-10" title="10">output &lt;-<span class="st"> </span><span class="kw">fun4</span>(<span class="dt">x =</span> vals_x, <span class="dt">y =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb138-11" title="11">output</a></code></pre></div>
<pre><code>##  [1] 4.880992 8.928873 2.073899 2.047614 6.753400 1.719961 3.929610
##  [8] 6.441054 1.992635 3.842700</code></pre>
<p>Much better!</p>
</div>
</div>
<div id="using-apply-functions" class="section level2">
<h2><span class="header-section-number">6.3</span> Using <code>apply</code> functions</h2>
<p>Once you have written a function, you will likely need to execute that function on multiple data sets or variables. This is where the <code>apply</code> functions come in handy.</p>
<p>The <code>apply</code> functions are a set of functions that can be used to, well, apply functions to lists, dataframes, and matrices. <code>apply</code> functions are similar to loops, but have a much simpler syntax.</p>
<p>There are several different functions that can be used depending upon the inputs and desired outputs. We will work through the following <code>apply</code> functions:</p>
<ol style="list-style-type: decimal">
<li><code>apply</code> - used with arrays, including matrices, and returns a vector, array, or list.</li>
<li><code>sapply</code> - (simplified apply) applies the function to each element of a vector, list, or matrix, and returns the outputs as a vector or matrix.</li>
<li><code>lapply</code> - (list apply) is similar to <code>sapply</code>, but returns a list of objects, rather than a vector.</li>
<li><code>mapply</code> - (multivariate apply) applies a function to the first elements of two or more vectors or lists, and then the second pair of elements, etc..</li>
</ol>
<p>If this doesn’t make much sense, don’t stress! We will walk though an example of each function and situations for which they might be useful.</p>
<div id="apply" class="section level3">
<h3><span class="header-section-number">6.3.1</span> <code>apply</code></h3>
<p>Let’s generate a theoretical transition matrix for a “before” and “after” data set that shows the number of transitions from one type to another.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" title="1">before &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="dv">1000</span>, <span class="dt">lambda =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb140-2" title="2">after &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="dv">1000</span>, <span class="dt">lambda =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb140-3" title="3">tab &lt;-<span class="st"> </span><span class="kw">table</span>(before, after)</a>
<a class="sourceLine" id="cb140-4" title="4">tab</a></code></pre></div>
<pre><code>##       after
## before   0   1   2   3   4   5
##      0 166 123  60  19   6   0
##      1 143 115  73  22  10   2
##      2  59  73  38  10   1   0
##      3  22  24  10   4   0   1
##      4   4   6   6   1   0   0
##      5   0   0   0   1   0   0
##      8   0   1   0   0   0   0</code></pre>
<p>We would like to convert this table to the relative probability for each transition- that is, what is the probability that an object of type “0” in the “before” dataset transitions to a 1? To a 2? 3?</p>
<p>To calculate the probability, we will need to get the sum of observations in each row, and then divide each transition in that particular row by the row sum. We can do this using the <code>apply</code> function.</p>
<p><code>apply</code> has three arguments: <code>X</code> is the array to which the function will be applied. <code>MARGIN</code> is used to identify whether the function should be applied to the rows, columns, or both. ‘1’ is for rows, ‘2’ is for columns, and c(1,2) can be used for both. <code>FUN</code> is the function to be applied.</p>
<p>In this scenario, we set <code>MARGIN = 1</code> so it will perform the function row wise. Up to this point, we have defined our functions outside of other commands, but in this scenario, it is a very simple function and so we can define the function within the command itself.</p>
<p>*Note: The <code>t()</code> function surrounding the command transposes the data set so it returns the matrix in the original orientation (before as rows and after as columns)</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" title="1">rel_prob &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(tab, <span class="dt">MARGIN =</span> <span class="dv">1</span>, <span class="dt">FUN =</span> <span class="cf">function</span> (i) {i<span class="op">/</span><span class="kw">sum</span>(i)} ))</a>
<a class="sourceLine" id="cb142-2" title="2">rel_prob</a></code></pre></div>
<pre><code>##       after
## before         0         1         2          3           4           5
##      0 0.4438503 0.3288770 0.1604278 0.05080214 0.016042781 0.000000000
##      1 0.3917808 0.3150685 0.2000000 0.06027397 0.027397260 0.005479452
##      2 0.3259669 0.4033149 0.2099448 0.05524862 0.005524862 0.000000000
##      3 0.3606557 0.3934426 0.1639344 0.06557377 0.000000000 0.016393443
##      4 0.2352941 0.3529412 0.3529412 0.05882353 0.000000000 0.000000000
##      5 0.0000000 0.0000000 0.0000000 1.00000000 0.000000000 0.000000000
##      8 0.0000000 1.0000000 0.0000000 0.00000000 0.000000000 0.000000000</code></pre>
<p>Hurray! Please not that there are other ways to perform the same task, but this one is a conceptually a simple example :)</p>
</div>
<div id="sapply" class="section level3">
<h3><span class="header-section-number">6.3.2</span> <code>sapply</code></h3>
<p>Let’s check out the Loblolly dataset. It contains the height, age, and seed source of a sample of Loblolly pines.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" title="1"><span class="kw">library</span>(datasets)</a>
<a class="sourceLine" id="cb144-2" title="2"></a>
<a class="sourceLine" id="cb144-3" title="3"><span class="kw">data</span>(Loblolly)</a>
<a class="sourceLine" id="cb144-4" title="4"><span class="kw">head</span>(Loblolly)</a></code></pre></div>
<pre><code>##    height age Seed
## 1    4.51   3  301
## 15  10.89   5  301
## 29  28.72  10  301
## 43  41.74  15  301
## 57  52.70  20  301
## 71  60.92  25  301</code></pre>
<p>The data set includes a range of ages. Let’s see if we can write a function that calculates the mean height for each age group.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" title="1"><span class="co">#Create a list with each unique age group</span></a>
<a class="sourceLine" id="cb146-2" title="2">ages &lt;-<span class="st"> </span><span class="kw">unique</span>(Loblolly<span class="op">$</span>age)</a>
<a class="sourceLine" id="cb146-3" title="3">ages</a></code></pre></div>
<pre><code>## [1]  3  5 10 15 20 25</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" title="1"><span class="co">#Create a function that calculates the mean height for each age group</span></a>
<a class="sourceLine" id="cb148-2" title="2">fun5 &lt;-<span class="st"> </span><span class="cf">function</span> (x){</a>
<a class="sourceLine" id="cb148-3" title="3">  agegroup &lt;-<span class="st"> </span><span class="kw">subset</span>(Loblolly, age <span class="op">==</span><span class="st"> </span>x)</a>
<a class="sourceLine" id="cb148-4" title="4">  mean_height &lt;-<span class="st"> </span><span class="kw">mean</span>(agegroup<span class="op">$</span>height)</a>
<a class="sourceLine" id="cb148-5" title="5">  <span class="kw">return</span>(mean_height)</a>
<a class="sourceLine" id="cb148-6" title="6">}</a>
<a class="sourceLine" id="cb148-7" title="7"></a>
<a class="sourceLine" id="cb148-8" title="8"><span class="kw">fun5</span>(ages)</a></code></pre></div>
<pre><code>## [1] 32.3644</code></pre>
<p>Hmmm, this returns one value rather than a separate mean for each group. Why is that?
In this function, x is a vector, and so the subset function selects the cases where age is equal to any of the values included in the <code>ages</code> vector. Because we have selected every value of age, we will get the mean height for the entire dataset.</p>
<p>If we would like a vector of the means for each height, we will can use <code>sapply</code>.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" title="1"><span class="co">#Create a function that calculates the mean height for each age group</span></a>
<a class="sourceLine" id="cb150-2" title="2">mean_heights &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dt">X =</span> ages, <span class="dt">FUN =</span> fun5)</a>
<a class="sourceLine" id="cb150-3" title="3">mean_heights</a></code></pre></div>
<pre><code>## [1]  4.237857 10.205000 27.442143 40.543571 51.468571 60.289286</code></pre>
<p>Excellent! We now have a vector with the mean height for each age group!</p>
</div>
<div id="lapply" class="section level3">
<h3><span class="header-section-number">6.3.3</span> <code>lapply</code></h3>
<p>You can use the <code>lapply</code> function to get the same information, but in a list format.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" title="1">heights &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dt">X =</span> ages, <span class="dt">FUN =</span> fun5)</a>
<a class="sourceLine" id="cb152-2" title="2">heights</a></code></pre></div>
<pre><code>## [[1]]
## [1] 4.237857
## 
## [[2]]
## [1] 10.205
## 
## [[3]]
## [1] 27.44214
## 
## [[4]]
## [1] 40.54357
## 
## [[5]]
## [1] 51.46857
## 
## [[6]]
## [1] 60.28929</code></pre>
<p>In this scenario, <code>sapply</code> might be a better fit. <code>lapply</code> is generally more useful if your output is a an object like a <code>data.frame</code> or produces objects of different types.</p>
<p>Let’s write a function that creates a subsetted <code>data.frame</code> for each value of tree age.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" title="1">ages &lt;-<span class="st"> </span><span class="kw">unique</span>(Loblolly<span class="op">$</span>age)</a>
<a class="sourceLine" id="cb154-2" title="2"></a>
<a class="sourceLine" id="cb154-3" title="3">func6 &lt;-<span class="st"> </span><span class="cf">function</span> (x){</a>
<a class="sourceLine" id="cb154-4" title="4">  <span class="kw">subset</span>(Loblolly, age <span class="op">==</span><span class="st"> </span>x)</a>
<a class="sourceLine" id="cb154-5" title="5">}</a>
<a class="sourceLine" id="cb154-6" title="6"></a>
<a class="sourceLine" id="cb154-7" title="7">sub_df &lt;-<span class="st"> </span><span class="kw">lapply</span>(ages, func6)</a>
<a class="sourceLine" id="cb154-8" title="8"></a>
<a class="sourceLine" id="cb154-9" title="9"><span class="co">#Let&#39;s look at items 1 and 2 in the list</span></a>
<a class="sourceLine" id="cb154-10" title="10">sub_df[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</a></code></pre></div>
<pre><code>## [[1]]
##    height age Seed
## 1    4.51   3  301
## 2    4.55   3  303
## 3    4.79   3  305
## 4    3.91   3  307
## 5    4.81   3  309
## 6    3.88   3  311
## 7    4.32   3  315
## 8    4.57   3  319
## 9    3.77   3  321
## 10   4.33   3  323
## 11   4.38   3  325
## 12   4.12   3  327
## 13   3.93   3  329
## 14   3.46   3  331
## 
## [[2]]
##    height age Seed
## 15  10.89   5  301
## 16  10.92   5  303
## 17  11.37   5  305
## 18   9.48   5  307
## 19  11.20   5  309
## 20   9.40   5  311
## 21  10.43   5  315
## 22  10.57   5  319
## 23   9.03   5  321
## 24  10.79   5  323
## 25  10.48   5  325
## 26   9.92   5  327
## 27   9.34   5  329
## 28   9.05   5  331</code></pre>
</div>
<div id="mapply" class="section level3">
<h3><span class="header-section-number">6.3.4</span> <code>mapply</code></h3>
<p><code>mapply</code> is an extremely useful function that is a great way to avoid using <code>for</code> loops! With <code>mapply</code>, you can use multiple input variables and it will iterate through each pair (or trio or more) of variables as inputs for the function.</p>
<p>Let’s say we would like to generate a theoretical normal distribution of tree height for each age group based on the mean and standard deviation of height. We will need a vector of means and a vector of heights to use as input values. We have already genereated a vector of means in our <code>sapply</code> example, so we will use a similar equation to generate a vector of sd.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" title="1">fun6 &lt;-<span class="st"> </span><span class="cf">function</span> (x){</a>
<a class="sourceLine" id="cb156-2" title="2">  agegroup &lt;-<span class="st"> </span><span class="kw">subset</span>(Loblolly, age <span class="op">==</span><span class="st"> </span>x)</a>
<a class="sourceLine" id="cb156-3" title="3">  <span class="kw">sd</span>(agegroup<span class="op">$</span>height)</a>
<a class="sourceLine" id="cb156-4" title="4">}</a>
<a class="sourceLine" id="cb156-5" title="5"></a>
<a class="sourceLine" id="cb156-6" title="6">sd_height &lt;-<span class="st"> </span><span class="kw">sapply</span>(ages, fun6)</a>
<a class="sourceLine" id="cb156-7" title="7">sd_height</a></code></pre></div>
<pre><code>## [1] 0.4036026 0.8155767 1.5378866 1.9508444 2.2118278 2.2688339</code></pre>
<p>Now, we can write a function that takes the two variables and applied it to each pair of input values to generate 6 six distributions.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" title="1">fun7 &lt;-<span class="st"> </span><span class="cf">function</span> (x, y){</a>
<a class="sourceLine" id="cb158-2" title="2">  <span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dt">mean =</span> x, <span class="dt">sd =</span> y)</a>
<a class="sourceLine" id="cb158-3" title="3">}</a>
<a class="sourceLine" id="cb158-4" title="4"></a>
<a class="sourceLine" id="cb158-5" title="5">height_dists &lt;-<span class="st"> </span><span class="kw">mapply</span>(<span class="dt">FUN =</span> fun7, <span class="dt">x =</span> mean_heights, <span class="dt">y =</span> sd_height)</a>
<a class="sourceLine" id="cb158-6" title="6"><span class="kw">colnames</span>(height_dists) &lt;-<span class="st"> </span>ages <span class="co">#This names the columns by the tree age</span></a>
<a class="sourceLine" id="cb158-7" title="7"><span class="kw">summary</span>(height_dists)</a></code></pre></div>
<pre><code>##        3               5                10              15       
##  Min.   :3.157   Min.   : 7.647   Min.   :22.45   Min.   :37.34  
##  1st Qu.:3.999   1st Qu.: 9.685   1st Qu.:26.67   1st Qu.:38.99  
##  Median :4.252   Median :10.199   Median :27.41   Median :40.23  
##  Mean   :4.264   Mean   :10.178   Mean   :27.46   Mean   :40.34  
##  3rd Qu.:4.524   3rd Qu.:10.680   3rd Qu.:28.60   3rd Qu.:41.51  
##  Max.   :5.300   Max.   :11.991   Max.   :30.81   Max.   :44.76  
##        20              25       
##  Min.   :46.62   Min.   :54.92  
##  1st Qu.:50.30   1st Qu.:58.81  
##  Median :51.66   Median :60.18  
##  Mean   :51.86   Mean   :60.22  
##  3rd Qu.:53.42   3rd Qu.:61.37  
##  Max.   :57.42   Max.   :65.47</code></pre>
</div>
</div>
<div id="loops" class="section level2">
<h2><span class="header-section-number">6.4</span> Loops</h2>
<p>I haven’t done this part yet!</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
