<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Loops and apply | Intro to R for Forest Ecosystem Science</title>
  <meta name="description" content="Introductory R" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Loops and apply | Intro to R for Forest Ecosystem Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Introductory R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Loops and apply | Intro to R for Forest Ecosystem Science" />
  
  <meta name="twitter:description" content="Introductory R" />
  

<meta name="author" content="Anu Singh, Benjamin Wagner, and Kaitlyn Hammond" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functions-in-r.html"/>
<link rel="next" href="working-with-spatial-data-in-r.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i><b>1.1</b> Disclaimer</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="a-few-words-on-a-productive-setup-and-workflow-in-r-with-r-studio.html"><a href="a-few-words-on-a-productive-setup-and-workflow-in-r-with-r-studio.html"><i class="fa fa-check"></i><b>2</b> A few words on a productive setup and workflow in <code>R</code> with <em>R-Studio</em></a><ul>
<li class="chapter" data-level="2.1" data-path="a-few-words-on-a-productive-setup-and-workflow-in-r-with-r-studio.html"><a href="a-few-words-on-a-productive-setup-and-workflow-in-r-with-r-studio.html#r-projects"><i class="fa fa-check"></i><b>2.1</b> R Projects</a></li>
<li class="chapter" data-level="2.2" data-path="a-few-words-on-a-productive-setup-and-workflow-in-r-with-r-studio.html"><a href="a-few-words-on-a-productive-setup-and-workflow-in-r-with-r-studio.html#setting-up-the-r-studio-user-interface"><i class="fa fa-check"></i><b>2.2</b> Setting up the R-Studio User interface</a></li>
<li class="chapter" data-level="2.3" data-path="a-few-words-on-a-productive-setup-and-workflow-in-r-with-r-studio.html"><a href="a-few-words-on-a-productive-setup-and-workflow-in-r-with-r-studio.html#code-folds-and-commenting"><i class="fa fa-check"></i><b>2.3</b> Code folds and commenting</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introducing-the-koala-dataset.html"><a href="introducing-the-koala-dataset.html"><i class="fa fa-check"></i><b>3</b> Introducing the koala dataset</a><ul>
<li class="chapter" data-level="3.1" data-path="introducing-the-koala-dataset.html"><a href="introducing-the-koala-dataset.html#data-types-and-variable-types"><i class="fa fa-check"></i><b>3.1</b> <em>data types</em> and <em>variable types</em></a></li>
<li class="chapter" data-level="3.2" data-path="introducing-the-koala-dataset.html"><a href="introducing-the-koala-dataset.html#changing-variable-types"><i class="fa fa-check"></i><b>3.2</b> Changing <em>variable types</em></a></li>
<li class="chapter" data-level="3.3" data-path="introducing-the-koala-dataset.html"><a href="introducing-the-koala-dataset.html#how-the-koala-dataset-was-collated"><i class="fa fa-check"></i><b>3.3</b> How the koala dataset was collated</a><ul>
<li class="chapter" data-level="3.3.1" data-path="introducing-the-koala-dataset.html"><a href="introducing-the-koala-dataset.html#loading-the-raw-data"><i class="fa fa-check"></i><b>3.3.1</b> Loading the raw data</a></li>
<li class="chapter" data-level="3.3.2" data-path="introducing-the-koala-dataset.html"><a href="introducing-the-koala-dataset.html#adding-the-state-names-by-location"><i class="fa fa-check"></i><b>3.3.2</b> Adding the state names by location</a></li>
<li class="chapter" data-level="3.3.3" data-path="introducing-the-koala-dataset.html"><a href="introducing-the-koala-dataset.html#creating-dummy-data"><i class="fa fa-check"></i><b>3.3.3</b> Creating dummy data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><i class="fa fa-check"></i><b>4</b> <code>dplyr</code> - A brief introduction to tidy data manipulation</a><ul>
<li class="chapter" data-level="4.1" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#loading-and-checking-the-data"><i class="fa fa-check"></i><b>4.1</b> Loading and checking the data</a></li>
<li class="chapter" data-level="4.2" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#working-with-dplyr"><i class="fa fa-check"></i><b>4.2</b> Working with <code>dplyr</code></a><ul>
<li class="chapter" data-level="4.2.1" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#select-and-dplyrs-pipe"><i class="fa fa-check"></i><b>4.2.1</b> select() and dplyr’s pipe</a></li>
<li class="chapter" data-level="4.2.2" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#filter"><i class="fa fa-check"></i><b>4.2.2</b> filter()</a></li>
<li class="chapter" data-level="4.2.3" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-1"><i class="fa fa-check"></i><b>4.2.3</b> Challenge 1</a></li>
<li class="chapter" data-level="4.2.4" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#group_by-and-summarise"><i class="fa fa-check"></i><b>4.2.4</b> group_by() and summarise()</a></li>
<li class="chapter" data-level="4.2.5" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-2"><i class="fa fa-check"></i><b>4.2.5</b> Challenge 2</a></li>
<li class="chapter" data-level="4.2.6" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#mutate"><i class="fa fa-check"></i><b>4.2.6</b> mutate()</a></li>
<li class="chapter" data-level="4.2.7" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-3"><i class="fa fa-check"></i><b>4.2.7</b> Challenge 3</a></li>
<li class="chapter" data-level="4.2.8" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#pivoting"><i class="fa fa-check"></i><b>4.2.8</b> Pivoting</a></li>
<li class="chapter" data-level="4.2.9" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-4"><i class="fa fa-check"></i><b>4.2.9</b> Challenge 4</a></li>
<li class="chapter" data-level="4.2.10" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-5"><i class="fa fa-check"></i><b>4.2.10</b> Challenge 5</a></li>
<li class="chapter" data-level="4.2.11" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#solution-to-all-challenges"><i class="fa fa-check"></i><b>4.2.11</b> Solution to all challenges</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="introduction-to-data-visualization-in-ggplot2.html"><a href="introduction-to-data-visualization-in-ggplot2.html"><i class="fa fa-check"></i><b>5</b> Introduction to data visualization in <code>ggplot2</code></a></li>
<li class="chapter" data-level="6" data-path="introduction-to-linear-models-in-r.html"><a href="introduction-to-linear-models-in-r.html"><i class="fa fa-check"></i><b>6</b> Introduction to linear models in R</a></li>
<li class="chapter" data-level="7" data-path="functions-in-r.html"><a href="functions-in-r.html"><i class="fa fa-check"></i><b>7</b> Functions in R</a><ul>
<li class="chapter" data-level="7.1" data-path="functions-in-r.html"><a href="functions-in-r.html#introduction-1"><i class="fa fa-check"></i><b>7.1</b> Introduction</a><ul>
<li class="chapter" data-level="7.1.1" data-path="functions-in-r.html"><a href="functions-in-r.html#mathematical-operations"><i class="fa fa-check"></i><b>7.1.1</b> Mathematical operations</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="functions-in-r.html"><a href="functions-in-r.html#what-is-an-r-function"><i class="fa fa-check"></i><b>7.2</b> What is an R function?</a></li>
<li class="chapter" data-level="7.3" data-path="functions-in-r.html"><a href="functions-in-r.html#nesting-functions"><i class="fa fa-check"></i><b>7.3</b> Nesting functions</a><ul>
<li class="chapter" data-level="7.3.1" data-path="functions-in-r.html"><a href="functions-in-r.html#some-basic-built-in-mathematical-functions"><i class="fa fa-check"></i><b>7.3.1</b> Some basic built-in mathematical functions</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="functions-in-r.html"><a href="functions-in-r.html#assigning-variables-within-functions"><i class="fa fa-check"></i><b>7.4</b> Assigning variables within functions</a><ul>
<li class="chapter" data-level="7.4.1" data-path="functions-in-r.html"><a href="functions-in-r.html#challenge-1-2"><i class="fa fa-check"></i><b>7.4.1</b> Challenge 1</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="functions-in-r.html"><a href="functions-in-r.html#using-return"><i class="fa fa-check"></i><b>7.5</b> Using <code>return()</code></a><ul>
<li class="chapter" data-level="7.5.1" data-path="functions-in-r.html"><a href="functions-in-r.html#challenge-2-2"><i class="fa fa-check"></i><b>7.5.1</b> Challenge 2</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="functions-in-r.html"><a href="functions-in-r.html#solutions-to-challenges"><i class="fa fa-check"></i><b>7.6</b> Solutions to challenges</a><ul>
<li class="chapter" data-level="7.6.1" data-path="functions-in-r.html"><a href="functions-in-r.html#challenge-1-3"><i class="fa fa-check"></i><b>7.6.1</b> Challenge 1</a></li>
<li class="chapter" data-level="7.6.2" data-path="functions-in-r.html"><a href="functions-in-r.html#challenge-2-3"><i class="fa fa-check"></i><b>7.6.2</b> Challenge 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="loops-and-apply.html"><a href="loops-and-apply.html"><i class="fa fa-check"></i><b>8</b> Loops and <code>apply</code></a><ul>
<li class="chapter" data-level="8.1" data-path="loops-and-apply.html"><a href="loops-and-apply.html#introduction-2"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="loops-and-apply.html"><a href="loops-and-apply.html#so-what-do-you-want-to-repeat"><i class="fa fa-check"></i><b>8.2</b> So, what do you want to repeat?</a></li>
<li class="chapter" data-level="8.3" data-path="loops-and-apply.html"><a href="loops-and-apply.html#dont-use-a-loop-when-you-can-use-apply"><i class="fa fa-check"></i><b>8.3</b> DON’T USE A LOOP WHEN YOU CAN USE APPLY!</a></li>
<li class="chapter" data-level="8.4" data-path="loops-and-apply.html"><a href="loops-and-apply.html#the-apply-family"><i class="fa fa-check"></i><b>8.4</b> The <code>apply</code> family</a><ul>
<li class="chapter" data-level="8.4.1" data-path="loops-and-apply.html"><a href="loops-and-apply.html#sapply"><i class="fa fa-check"></i><b>8.4.1</b> <code>sapply</code></a></li>
<li class="chapter" data-level="8.4.2" data-path="loops-and-apply.html"><a href="loops-and-apply.html#lapply"><i class="fa fa-check"></i><b>8.4.2</b> <code>lapply</code></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="loops-and-apply.html"><a href="loops-and-apply.html#for-loops"><i class="fa fa-check"></i><b>8.5</b> <code>for</code> loops</a><ul>
<li class="chapter" data-level="8.5.1" data-path="loops-and-apply.html"><a href="loops-and-apply.html#some-for-loop-hints"><i class="fa fa-check"></i><b>8.5.1</b> Some <code>for</code> loop hints</a></li>
<li class="chapter" data-level="8.5.2" data-path="loops-and-apply.html"><a href="loops-and-apply.html#challenge"><i class="fa fa-check"></i><b>8.5.2</b> Challenge</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="loops-and-apply.html"><a href="loops-and-apply.html#solutions-to-challenge"><i class="fa fa-check"></i><b>8.6</b> Solutions to challenge</a></li>
<li class="chapter" data-level="8.7" data-path="loops-and-apply.html"><a href="loops-and-apply.html#bonus-changing-plot-labels"><i class="fa fa-check"></i><b>8.7</b> Bonus: Changing plot labels</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html"><i class="fa fa-check"></i><b>9</b> Working with spatial data in <code>R</code></a><ul>
<li class="chapter" data-level="9.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#transforming-a-dataset-into-an-sf-object"><i class="fa fa-check"></i><b>9.1</b> Transforming a dataset into an <code>sf</code> object</a></li>
<li class="chapter" data-level="9.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#loading-shapefiles-into-r-transforming-and-plotting"><i class="fa fa-check"></i><b>9.2</b> Loading shapefiles into <code>R</code>, transforming and plotting</a><ul>
<li class="chapter" data-level="9.2.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#challenge-1-4"><i class="fa fa-check"></i><b>9.2.1</b> Challenge 1</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#simple-geometric-operations"><i class="fa fa-check"></i><b>9.3</b> Simple geometric operations</a></li>
<li class="chapter" data-level="9.4" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#making-a-map-using-ggplot2"><i class="fa fa-check"></i><b>9.4</b> Making a map using <code>ggplot2</code></a><ul>
<li class="chapter" data-level="9.4.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#challenge-2-4"><i class="fa fa-check"></i><b>9.4.1</b> Challenge 2</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#r-raster-basics"><i class="fa fa-check"></i><b>9.5</b> <code>R</code> raster basics</a></li>
<li class="chapter" data-level="9.6" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#plotting-rasters-in-ggplot2"><i class="fa fa-check"></i><b>9.6</b> Plotting rasters in <code>ggplot2</code></a><ul>
<li class="chapter" data-level="9.6.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#challenge-3-2"><i class="fa fa-check"></i><b>9.6.1</b> Challenge 3</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#solutions-to-challenges-1"><i class="fa fa-check"></i><b>9.7</b> Solutions to Challenges</a><ul>
<li class="chapter" data-level="9.7.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#challenge-1-5"><i class="fa fa-check"></i><b>9.7.1</b> Challenge 1</a></li>
<li class="chapter" data-level="9.7.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#challenge-2-5"><i class="fa fa-check"></i><b>9.7.2</b> Challenge 2</a></li>
<li class="chapter" data-level="9.7.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#challenge-3-3"><i class="fa fa-check"></i><b>9.7.3</b> Challenge 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html"><i class="fa fa-check"></i><b>10</b> Spatial tools for forestry and ecological applications</a><ul>
<li class="chapter" data-level="10.1" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#an-introduction-to-processing-lidar-data-in-r"><i class="fa fa-check"></i><b>10.1</b> An introduction to processing LiDAR data in <code>R</code></a></li>
<li class="chapter" data-level="10.2" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#working-with-lidar-data-in-r"><i class="fa fa-check"></i><b>10.2</b> Working with LiDAR data in R</a></li>
<li class="chapter" data-level="10.3" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#step-1.-loading-and-visualizing-pointclouds"><i class="fa fa-check"></i><b>10.3</b> Step 1. Loading and visualizing pointclouds</a></li>
<li class="chapter" data-level="10.4" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#step-2.-computing-a-canopy-height-model"><i class="fa fa-check"></i><b>10.4</b> Step 2. Computing a canopy height model</a><ul>
<li class="chapter" data-level="10.4.1" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#ground-detection-and-normalizing-a-point-cloud"><i class="fa fa-check"></i><b>10.4.1</b> Ground detection and normalizing a point cloud</a></li>
<li class="chapter" data-level="10.4.2" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#building-the-initial-chm"><i class="fa fa-check"></i><b>10.4.2</b> Building the initial CHM</a></li>
<li class="chapter" data-level="10.4.3" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#challenge-1-6"><i class="fa fa-check"></i><b>10.4.3</b> Challenge 1</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#step-3.-individual-tree-segmentation"><i class="fa fa-check"></i><b>10.5</b> Step 3. Individual tree segmentation</a><ul>
<li class="chapter" data-level="10.5.1" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#delineating-the-crowns"><i class="fa fa-check"></i><b>10.5.1</b> Delineating the crowns</a></li>
<li class="chapter" data-level="10.5.2" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#challenge-2-6"><i class="fa fa-check"></i><b>10.5.2</b> Challenge 2</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#additional-analysis-computing-a-digital-terrain-model-dtm"><i class="fa fa-check"></i><b>10.6</b> Additional analysis: Computing a digital terrain model (DTM)</a><ul>
<li class="chapter" data-level="10.6.1" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#challenge-3-4"><i class="fa fa-check"></i><b>10.6.1</b> Challenge 3</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#wrapping-up"><i class="fa fa-check"></i><b>10.7</b> Wrapping up</a></li>
<li class="chapter" data-level="10.8" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#solutions-to-the-challenges"><i class="fa fa-check"></i><b>10.8</b> Solutions to the challenges</a><ul>
<li class="chapter" data-level="10.8.1" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#challenge-1-7"><i class="fa fa-check"></i><b>10.8.1</b> Challenge 1</a></li>
<li class="chapter" data-level="10.8.2" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#challenge-2-7"><i class="fa fa-check"></i><b>10.8.2</b> Challenge 2</a></li>
<li class="chapter" data-level="10.8.3" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#challenge-3-5"><i class="fa fa-check"></i><b>10.8.3</b> Challenge 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><i class="fa fa-check"></i><b>11</b> Extracting raster fractions and area using a polygon mask</a><ul>
<li class="chapter" data-level="11.1" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#problem-statement"><i class="fa fa-check"></i><b>11.1</b> Problem statement</a></li>
<li class="chapter" data-level="11.2" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#creating-some-dummy-raster-data"><i class="fa fa-check"></i><b>11.2</b> Creating some dummy raster data</a></li>
<li class="chapter" data-level="11.3" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#create-some-reserves"><i class="fa fa-check"></i><b>11.3</b> Create some reserves</a></li>
<li class="chapter" data-level="11.4" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#extracting-data"><i class="fa fa-check"></i><b>11.4</b> Extracting data</a></li>
<li class="chapter" data-level="11.5" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#plotting-the-results"><i class="fa fa-check"></i><b>11.5</b> Plotting the results</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html"><i class="fa fa-check"></i><b>12</b> Calculating class area from raster</a><ul>
<li class="chapter" data-level="12.1" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html#simple-area-and-area-fraction-calculations-on-a-classified-raster"><i class="fa fa-check"></i><b>12.1</b> Simple area and area fraction calculations on a classified raster</a><ul>
<li class="chapter" data-level="12.1.1" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html#creating-dummy-data-1"><i class="fa fa-check"></i><b>12.1.1</b> Creating dummy data</a></li>
<li class="chapter" data-level="12.1.2" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html#preparing-the-raster-for-area-calculation"><i class="fa fa-check"></i><b>12.1.2</b> Preparing the raster for area calculation</a></li>
<li class="chapter" data-level="12.1.3" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html#compiling-a-comprehensive-table"><i class="fa fa-check"></i><b>12.1.3</b> Compiling a comprehensive table</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro to R for Forest Ecosystem Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="loops-and-apply" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Loops and <code>apply</code></h1>
<div id="introduction-2" class="section level2">
<h2><span class="header-section-number">8.1</span> Introduction</h2>
<p>Data analysis often requires repeating a particular function on multiple data observations, groups of observations, or separate data sets. Many novice users begin with the strategy of assigning a new variable for each input, or copying and pasting code. While this certainly works, it can be very time consuming and makes it easy to make silly mistakes. There are several alternative strategies that can be used to repeat tasks for multiple variables or data sets that avoid this risk.</p>
<p>In this tutorial, we will focus on the <code>apply</code> family of functions and introduce loops. We will build on the skills we learned in our previous tutorials using <code>dplyr</code> and <code>ggplot2</code>, so if you are unfamiliar with the <code>tidyverse</code> syntax, it would be helpful to review these sections.</p>
</div>
<div id="so-what-do-you-want-to-repeat" class="section level2">
<h2><span class="header-section-number">8.2</span> So, what do you want to repeat?</h2>
<p>For any given task, there are several possible approaches for how to repeat it. In general, the first point to consider is whether the order of iteration matters or if it does not matter.</p>
<p>What does this mean?</p>
<p>Let’s consider an example from our previous tutorial. We built a model using one predictor variable, but we would like to compare this model to models built using other predictor variables. In this situation, it doesn’t matter whether we build model A before we build model B– they are completely independent of each other. Here, the order of iteration does <em>not</em> matter.</p>
<p>Now consider a situation where our process has several steps. Perhaps we need to generate a data set A and save that data set to be used to calculate B, then use B to calculate C. In this situation, the sequence <em>does</em> matter.</p>
<p>In situations where the sequence does not matter, you can use <code>apply</code> functions. If the sequence does matter, you will need to use a loop.</p>
</div>
<div id="dont-use-a-loop-when-you-can-use-apply" class="section level2">
<h2><span class="header-section-number">8.3</span> DON’T USE A LOOP WHEN YOU CAN USE APPLY!</h2>
<p>Loops can be very useful, but can be complicated, messy, and easy to break. They are also harder to troubleshoot. The loop may run without producing the desired output and it can be difficult to figure out why. It is FAR more common that the order of iteration does not matter, and even if it does matter, a well-written function can usually help you avoid needing a loop!</p>
<p><code>apply</code> functions are simple and clean and more difficult to mess up! If you can use one instead of a loop, you should!</p>
</div>
<div id="the-apply-family" class="section level2">
<h2><span class="header-section-number">8.4</span> The <code>apply</code> family</h2>
<p>Ok, so what is <code>apply</code>?</p>
<p>The <code>apply</code> functions are a set of functions that can be used to, well, apply functions to lists, dataframes, and matrices. <code>apply</code> functions are similar to loops, but have a much simpler syntax.</p>
<p>There are several different functions that can be used depending upon the inputs and desired outputs. These include:</p>
<ol style="list-style-type: decimal">
<li><code>apply</code> - used with arrays, including matrices, and returns a vector, array, or list.</li>
<li><code>sapply</code> - (simplified apply) applies the function to each element of a vector, list, or matrix, and returns the outputs as a vector or matrix.</li>
<li><code>lapply</code> - (list apply) is similar to <code>sapply</code>, but returns a list of objects, rather than a vector.</li>
<li><code>mapply</code> - (multivariate apply) applies a function to the first elements of two or more vectors or lists, and then the second pair of elements, etc..</li>
</ol>
<p>If this doesn’t make much sense, don’t stress! We will work through <code>sapply</code> and <code>lapply</code>.</p>
<div id="sapply" class="section level3">
<h3><span class="header-section-number">8.4.1</span> <code>sapply</code></h3>
<p>Let’s take a quick look at our koala dataset.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" title="1">koala &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/koala.csv&#39;</span>)</a>
<a class="sourceLine" id="cb212-2" title="2"></a>
<a class="sourceLine" id="cb212-3" title="3"><span class="kw">names</span>(koala)</a></code></pre></div>
<pre><code>##  [1] &quot;species&quot; &quot;X&quot;       &quot;Y&quot;       &quot;state&quot;   &quot;region&quot;  &quot;sex&quot;     &quot;weight&quot; 
##  [8] &quot;size&quot;    &quot;fur&quot;     &quot;tail&quot;    &quot;age&quot;     &quot;color&quot;   &quot;joey&quot;    &quot;behav&quot;  
## [15] &quot;obs&quot;</code></pre>
<p>In a previous section, we built a linear model that predicted weight based on fur.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" title="1">linearmodel&lt;-<span class="kw">lm</span>(weight<span class="op">~</span>fur, <span class="dt">data=</span>koala)</a>
<a class="sourceLine" id="cb214-2" title="2"><span class="kw">summary</span>(linearmodel)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = weight ~ fur, data = koala)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.8853 -1.0215 -0.2989  0.9245  8.4996 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   3.4409     0.4569   7.531 1.02e-12 ***
## fur           1.5477     0.1527  10.137  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.792 on 240 degrees of freedom
## Multiple R-squared:  0.2998, Adjusted R-squared:  0.2969 
## F-statistic: 102.8 on 1 and 240 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>We would like to see whether one of our other numeric variables (size, tail length, or age) might be a better predictor for weight than fur. We could write three separate models, or we could make a basic function that tests out each of these variables and gives us our R-squared value.</p>
<p>Our <code>linearmodel</code> object has a number of items we can extract.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" title="1"><span class="kw">names</span>(<span class="kw">summary</span>(linearmodel))</a></code></pre></div>
<pre><code>##  [1] &quot;call&quot;          &quot;terms&quot;         &quot;residuals&quot;     &quot;coefficients&quot; 
##  [5] &quot;aliased&quot;       &quot;sigma&quot;         &quot;df&quot;            &quot;r.squared&quot;    
##  [9] &quot;adj.r.squared&quot; &quot;fstatistic&quot;    &quot;cov.unscaled&quot;</code></pre>
<p>To view only the R-squared value we can use the following code:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" title="1"><span class="kw">summary</span>(linearmodel)<span class="op">$</span>r.squared</a></code></pre></div>
<pre><code>## [1] 0.2997958</code></pre>
<p>We know that we want to run these two pieces of code several times, so let’s write a simple function that does it for us. In this situation, we are only going to change one thing– our predictor variable – so we will use that as the input for our function.</p>
<p>Let’s try!</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" title="1">model_fun &lt;-<span class="st"> </span><span class="cf">function</span>(predictors) {</a>
<a class="sourceLine" id="cb220-2" title="2">  linearmodel =<span class="st"> </span><span class="kw">lm</span>(weight<span class="op">~</span>koala[,predictors], <span class="dt">data=</span>koala) <span class="co">#The brackets select the column to use in the koala dataframe</span></a>
<a class="sourceLine" id="cb220-3" title="3">  <span class="kw">summary</span>(linearmodel)<span class="op">$</span>r.squared</a>
<a class="sourceLine" id="cb220-4" title="4">}</a></code></pre></div>
<p>What is it we want to get out of this function? Since we are only looking for the R-squared value for each model as a vector, this is a great time to use <code>sapply</code> (simple apply!)</p>
<p>First, let’s create our input list of the columns we would like to compare:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" title="1">predictors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="co">#size, fur, tail, age</span></a></code></pre></div>
<p>Now we can use <code>sapply1</code> to build the model, extract the R-squared for each predictor</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" title="1"><span class="kw">sapply</span>(predictors, model_fun)</a></code></pre></div>
<pre><code>## [1] 0.235929039 0.299795840 0.002318631 0.002492435</code></pre>
<p>They’re all pretty bad, but now we know that age is the worst! :)</p>
</div>
<div id="lapply" class="section level3">
<h3><span class="header-section-number">8.4.2</span> <code>lapply</code></h3>
<p>The <code>lapply</code> function works just like <code>sapply</code>, but you can use it if you are producing more complex data, like a plot or model or raster, that needs to be contained in a list.</p>
<p>Despite the fact our models performed terribly, we decide it would be interesting to plot them.</p>
<p>In this scenario, once again, the only thing we are changing is the predictor variable, so we can write our <code>ggplot2</code> plot as a function, then run it using lapply:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" title="1">plot_fun &lt;-<span class="st"> </span><span class="cf">function</span>(predictors) {</a>
<a class="sourceLine" id="cb224-2" title="2">    <span class="kw">ggplot</span>(<span class="dt">data =</span> koala, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> koala[,predictors], <span class="dt">y =</span> weight)) <span class="op">+</span></a>
<a class="sourceLine" id="cb224-3" title="3"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb224-4" title="4"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</a>
<a class="sourceLine" id="cb224-5" title="5">}</a>
<a class="sourceLine" id="cb224-6" title="6"></a>
<a class="sourceLine" id="cb224-7" title="7"><span class="kw">lapply</span>(predictors, plot_fun)</a></code></pre></div>
<pre><code>## [[1]]</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="06-apply_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="06-apply_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="06-apply_files/figure-html/unnamed-chunk-9-3.png" width="672" /></p>
<pre><code>## 
## [[4]]</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="06-apply_files/figure-html/unnamed-chunk-9-4.png" width="672" /></p>
<p>An advantage to this is that you can assign this to a variable and each plot will be saved to a list that you can come back to later.</p>
<p>While in these examples we’ve used user-defined functions, you can use this with whatever built-in functions you want!</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" title="1"><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, paste, <span class="st">&quot;Apply functions are the best!&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;1 Apply functions are the best!&quot; &quot;2 Apply functions are the best!&quot;
## [3] &quot;3 Apply functions are the best!&quot; &quot;4 Apply functions are the best!&quot;
## [5] &quot;5 Apply functions are the best!&quot;</code></pre>
</div>
</div>
<div id="for-loops" class="section level2">
<h2><span class="header-section-number">8.5</span> <code>for</code> loops</h2>
<p><code>for</code> loops are structures similar to functions that iterate through a chunk of code for a certain number of repetitions. The basic structure of a <code>for</code> loop looks something like this:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" title="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>) {</a>
<a class="sourceLine" id="cb235-2" title="2">  <span class="kw">print</span>(<span class="st">&quot;R is so cool!&quot;</span>)</a>
<a class="sourceLine" id="cb235-3" title="3">}</a></code></pre></div>
<pre><code>## [1] &quot;R is so cool!&quot;
## [1] &quot;R is so cool!&quot;
## [1] &quot;R is so cool!&quot;
## [1] &quot;R is so cool!&quot;
## [1] &quot;R is so cool!&quot;</code></pre>
<p><code>for</code> loops start with the word for, and then in parentheses show the number of tasks and number of times it needs to be repeated. Next come curly brackets with the code that gets repeated.</p>
<p>Let’s go back to our R-squared example. We can do the same thing as we did using <code>sapply</code></p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" title="1">predictors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>)  </a>
<a class="sourceLine" id="cb237-2" title="2"></a>
<a class="sourceLine" id="cb237-3" title="3">model_fun &lt;-<span class="st"> </span><span class="cf">function</span>(predictors) {</a>
<a class="sourceLine" id="cb237-4" title="4">  linearmodel =<span class="st"> </span><span class="kw">lm</span>(weight<span class="op">~</span>koala[,predictors], <span class="dt">data=</span>koala) </a>
<a class="sourceLine" id="cb237-5" title="5">  <span class="kw">return</span>(<span class="kw">summary</span>(linearmodel)<span class="op">$</span>r.squared)</a>
<a class="sourceLine" id="cb237-6" title="6">}</a>
<a class="sourceLine" id="cb237-7" title="7"></a>
<a class="sourceLine" id="cb237-8" title="8"></a>
<a class="sourceLine" id="cb237-9" title="9"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(predictors)) { <span class="co">#&quot;length&quot; counts the number of items in the &quot;predictors&quot; vector </span></a>
<a class="sourceLine" id="cb237-10" title="10">  predictor &lt;-<span class="st"> </span>predictors[i] <span class="co">#This selects the ith observation in the predictors vector</span></a>
<a class="sourceLine" id="cb237-11" title="11">  <span class="kw">print</span>(<span class="kw">model_fun</span>(predictor))</a>
<a class="sourceLine" id="cb237-12" title="12">}</a></code></pre></div>
<pre><code>## [1] 0.235929
## [1] 0.2997958
## [1] 0.002318631
## [1] 0.002492435</code></pre>
<p>While you get the exact same results, the loop is messier than <code>sapply(predictors, plotfun)</code>, plus it can be some extra work to save the ouput from each iteration into a list or table, which is incredibly simple using lapply :)
(Am I biased or what? :P)</p>
<p><code>for</code> loops <em>are</em> useful in situations where each iteration depends on the result of the previous iteration.</p>
<div id="some-for-loop-hints" class="section level3">
<h3><span class="header-section-number">8.5.1</span> Some <code>for</code> loop hints</h3>
<ul>
<li><p>For some reason, i, j, and k are generally used in loops (while functions tend to use x and y). This is a good practice to get into just to avoid confusion.</p></li>
<li><p>It can be very annoying to constantly change the number of tasks based on your data set, so the <code>length()</code> function makes sure you have the right number every time.</p></li>
<li><p>Loops can be nice if the code you are running takes a long time and you may need to stop it and resume later. If you need to do tasks 1:400, you can stop the code and pick it up again at 200:400.</p></li>
<li><p>If you would like to save the output of a loop, you will need to create a blank table with the expected dimensions of your output values and then make the loop add the data to the table. Here is an example:</p></li>
</ul>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" title="1">blank_matrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">nrow =</span> <span class="dv">5</span>, <span class="dt">ncol =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb239-2" title="2"></a>
<a class="sourceLine" id="cb239-3" title="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){</a>
<a class="sourceLine" id="cb239-4" title="4">  text &lt;-<span class="st"> &quot;R is so cool!&quot;</span></a>
<a class="sourceLine" id="cb239-5" title="5">  blank_matrix [i, <span class="dv">1</span>] &lt;-<span class="st"> </span>text <span class="co">#This will assign the value of &quot;text&quot; to the ith row in the matrix</span></a>
<a class="sourceLine" id="cb239-6" title="6"></a>
<a class="sourceLine" id="cb239-7" title="7">}</a>
<a class="sourceLine" id="cb239-8" title="8"></a>
<a class="sourceLine" id="cb239-9" title="9">blank_matrix</a></code></pre></div>
<pre><code>##      [,1]           
## [1,] &quot;R is so cool!&quot;
## [2,] &quot;R is so cool!&quot;
## [3,] &quot;R is so cool!&quot;
## [4,] &quot;R is so cool!&quot;
## [5,] &quot;R is so cool!&quot;</code></pre>
</div>
<div id="challenge" class="section level3">
<h3><span class="header-section-number">8.5.2</span> Challenge</h3>
<p>Our koalas are many different ages and we would like to build a separate linear model that predicts fur based on weight for each age group.</p>
<p>Build either a <code>for</code> loop or a function used with <code>sapply</code> that shows us the R-squared value for a linear model built for each age group</p>
<p>Hints:</p>
<ol style="list-style-type: decimal">
<li><p>Figure out how many unique ages there are (you can look at the table or use <code>unique()</code> to get all the unique values in the column)</p></li>
<li><p>Filter to create a subset of data for koala age (Hint: go back to the <code>dplyr</code> section if you can’t remember how!)</p></li>
<li><p>Build your linear model using the subset of data</p></li>
<li><p>Think about which variable you will need to change each time to repeat this and build it into your loop or function</p></li>
</ol>
</div>
</div>
<div id="solutions-to-challenge" class="section level2">
<h2><span class="header-section-number">8.6</span> Solutions to challenge</h2>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" title="1">ages &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span></a>
<a class="sourceLine" id="cb241-2" title="2"></a>
<a class="sourceLine" id="cb241-3" title="3"><span class="co">#Using a for loop:</span></a>
<a class="sourceLine" id="cb241-4" title="4"></a>
<a class="sourceLine" id="cb241-5" title="5"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(ages)){</a>
<a class="sourceLine" id="cb241-6" title="6">  <span class="co">#Select the ith age in the list of koala ages</span></a>
<a class="sourceLine" id="cb241-7" title="7">  current_age &lt;-<span class="st"> </span>ages[i]</a>
<a class="sourceLine" id="cb241-8" title="8">  </a>
<a class="sourceLine" id="cb241-9" title="9">  <span class="co">#Filter the data to get only the koalas of that age</span></a>
<a class="sourceLine" id="cb241-10" title="10">  age_subset &lt;-<span class="st"> </span>koala <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(age <span class="op">==</span><span class="st"> </span>current_age)</a>
<a class="sourceLine" id="cb241-11" title="11">  </a>
<a class="sourceLine" id="cb241-12" title="12">  <span class="co">#Use lapply to get a list of each R-squared value for each predictor</span></a>
<a class="sourceLine" id="cb241-13" title="13">linearmodel =<span class="st"> </span><span class="kw">lm</span>(weight<span class="op">~</span>fur, <span class="dt">data=</span>age_subset)</a>
<a class="sourceLine" id="cb241-14" title="14">  <span class="kw">print</span>(<span class="kw">summary</span>(linearmodel)<span class="op">$</span>r.squared)</a>
<a class="sourceLine" id="cb241-15" title="15">  </a>
<a class="sourceLine" id="cb241-16" title="16">}</a></code></pre></div>
<pre><code>## [1] 0.6488455
## [1] 0.133633
## [1] 0.2721374
## [1] 0.7552257
## [1] 0.871621
## [1] 0.152498
## [1] 0.1551334
## [1] 0.2999077
## [1] 0.1281452
## [1] 0.5103155
## [1] 0.1243552
## [1] 0.1586713</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb243-1" title="1"><span class="co">#Using a function and lapply</span></a>
<a class="sourceLine" id="cb243-2" title="2"></a>
<a class="sourceLine" id="cb243-3" title="3">challenge_fun &lt;-<span class="st"> </span><span class="cf">function</span>(ages) {</a>
<a class="sourceLine" id="cb243-4" title="4">  age_subset &lt;-<span class="st"> </span>koala <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(age <span class="op">==</span><span class="st"> </span>ages)</a>
<a class="sourceLine" id="cb243-5" title="5">  linearmodel =<span class="st"> </span><span class="kw">lm</span>(weight<span class="op">~</span>fur, <span class="dt">data=</span>age_subset)</a>
<a class="sourceLine" id="cb243-6" title="6">  <span class="kw">summary</span>(linearmodel)<span class="op">$</span>r.squared</a>
<a class="sourceLine" id="cb243-7" title="7">}</a>
<a class="sourceLine" id="cb243-8" title="8"></a>
<a class="sourceLine" id="cb243-9" title="9"><span class="kw">sapply</span>(ages, challenge_fun)</a></code></pre></div>
<pre><code>##  [1] 0.6488455 0.1336330 0.2721374 0.7552257 0.8716210 0.1524980 0.1551334
##  [8] 0.2999077 0.1281452 0.5103155 0.1243552 0.1586713</code></pre>
</div>
<div id="bonus-changing-plot-labels" class="section level2">
<h2><span class="header-section-number">8.7</span> Bonus: Changing plot labels</h2>
<p>In the ggplot example, our x-axis label just said <code>koala[,predictors]</code>. To make it say the correct variable, you can do this:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb245-1" title="1">predictors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>)</a>
<a class="sourceLine" id="cb245-2" title="2">plot_fun &lt;-<span class="st"> </span><span class="cf">function</span>(predictors) {</a>
<a class="sourceLine" id="cb245-3" title="3"></a>
<a class="sourceLine" id="cb245-4" title="4">    predictor_name &lt;-<span class="st"> </span><span class="kw">colnames</span>(koala[predictors])  <span class="co">#Gets the column name for the current predictor</span></a>
<a class="sourceLine" id="cb245-5" title="5">  </a>
<a class="sourceLine" id="cb245-6" title="6">    <span class="kw">ggplot</span>(<span class="dt">data =</span> koala, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> koala[,predictors], <span class="dt">y =</span> weight)) <span class="op">+</span></a>
<a class="sourceLine" id="cb245-7" title="7"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb245-8" title="8"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb245-9" title="9"><span class="st">    </span><span class="kw">xlab</span>(<span class="kw">paste</span>(predictor_name)) <span class="co">#paste the contents of the predictor_name variable</span></a>
<a class="sourceLine" id="cb245-10" title="10">}</a>
<a class="sourceLine" id="cb245-11" title="11"></a>
<a class="sourceLine" id="cb245-12" title="12"><span class="kw">lapply</span>(predictors, plot_fun)</a></code></pre></div>
<pre><code>## [[1]]</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="06-apply_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="06-apply_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="06-apply_files/figure-html/unnamed-chunk-15-3.png" width="672" /></p>
<pre><code>## 
## [[4]]</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="06-apply_files/figure-html/unnamed-chunk-15-4.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functions-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="working-with-spatial-data-in-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
