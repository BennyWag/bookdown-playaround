<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Working with spatial data in R | Intro to R for Forest Ecosystem Science</title>
  <meta name="description" content="Introductory R" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Working with spatial data in R | Intro to R for Forest Ecosystem Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Introductory R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Working with spatial data in R | Intro to R for Forest Ecosystem Science" />
  
  <meta name="twitter:description" content="Introductory R" />
  

<meta name="author" content="Anu Singh, Benjamin Wagner, and Kaitlyn Hammond" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-to-linear-models-in-r.html"/>
<link rel="next" href="functions-loops-and-apply.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i><b>1.1</b> Disclaimer</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><i class="fa fa-check"></i><b>2</b> <code>dplyr</code> - A brief introduction to tidy data manipulation</a><ul>
<li class="chapter" data-level="2.1" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#introducing-the-koala-dataset"><i class="fa fa-check"></i><b>2.1</b> Introducing the koala dataset</a></li>
<li class="chapter" data-level="2.2" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#working-with-dplyr"><i class="fa fa-check"></i><b>2.2</b> Working with <code>dplyr</code></a><ul>
<li class="chapter" data-level="2.2.1" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#select-and-dplyrs-pipe"><i class="fa fa-check"></i><b>2.2.1</b> select() and dplyr’s pipe</a></li>
<li class="chapter" data-level="2.2.2" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#filter"><i class="fa fa-check"></i><b>2.2.2</b> filter()</a></li>
<li class="chapter" data-level="2.2.3" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-1"><i class="fa fa-check"></i><b>2.2.3</b> Challenge 1</a></li>
<li class="chapter" data-level="2.2.4" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#group_by-and-summarise"><i class="fa fa-check"></i><b>2.2.4</b> group_by() and summarise()</a></li>
<li class="chapter" data-level="2.2.5" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-2"><i class="fa fa-check"></i><b>2.2.5</b> Challenge 2</a></li>
<li class="chapter" data-level="2.2.6" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#mutate"><i class="fa fa-check"></i><b>2.2.6</b> mutate()</a></li>
<li class="chapter" data-level="2.2.7" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-3"><i class="fa fa-check"></i><b>2.2.7</b> Challenge 3</a></li>
<li class="chapter" data-level="2.2.8" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#solution-to-all-challenges"><i class="fa fa-check"></i><b>2.2.8</b> Solution to all challenges</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-data-visualization-in-ggplot2.html"><a href="introduction-to-data-visualization-in-ggplot2.html"><i class="fa fa-check"></i><b>3</b> Introduction to data visualization in <code>GGPLOT2</code></a></li>
<li class="chapter" data-level="4" data-path="introduction-to-linear-models-in-r.html"><a href="introduction-to-linear-models-in-r.html"><i class="fa fa-check"></i><b>4</b> Introduction to linear models in R</a></li>
<li class="chapter" data-level="5" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html"><i class="fa fa-check"></i><b>5</b> Working with spatial data in <code>R</code></a><ul>
<li class="chapter" data-level="5.1" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#transforming-a-dataset-into-an-sf-object"><i class="fa fa-check"></i><b>5.1</b> Transforming a dataset into an <code>sf</code> object</a></li>
<li class="chapter" data-level="5.2" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#loading-shapefiles-into-r-transforming-and-plotting"><i class="fa fa-check"></i><b>5.2</b> Loading shapefiles into <code>R</code>, transforming and plotting</a><ul>
<li class="chapter" data-level="5.2.1" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-1"><i class="fa fa-check"></i><b>5.2.1</b> Challenge 1</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#simple-geometric-operations"><i class="fa fa-check"></i><b>5.3</b> Simple geometric operations</a></li>
<li class="chapter" data-level="5.4" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#making-a-map-using-ggplot2"><i class="fa fa-check"></i><b>5.4</b> Making a map using <code>ggplot2</code></a><ul>
<li class="chapter" data-level="5.4.1" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-2"><i class="fa fa-check"></i><b>5.4.1</b> Challenge 2</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#r-raster-basics"><i class="fa fa-check"></i><b>5.5</b> <code>R</code> raster basics</a></li>
<li class="chapter" data-level="5.6" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#plotting-rasters-in-ggplot2"><i class="fa fa-check"></i><b>5.6</b> Plotting rasters in <code>ggplot2</code></a><ul>
<li class="chapter" data-level="5.6.1" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-3"><i class="fa fa-check"></i><b>5.6.1</b> Challenge 3</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="working-with-spatial-data-in-r.html"><a href="working-with-spatial-data-in-r.html#solutions-to-challenges"><i class="fa fa-check"></i><b>5.7</b> Solutions to Challenges</a><ul>
<li class="chapter" data-level="5.7.1" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-1-1"><i class="fa fa-check"></i><b>5.7.1</b> Challenge 1</a></li>
<li class="chapter" data-level="5.7.2" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-2-1"><i class="fa fa-check"></i><b>5.7.2</b> Challenge 2</a></li>
<li class="chapter" data-level="5.7.3" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-3-1"><i class="fa fa-check"></i><b>5.7.3</b> Challenge 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html"><i class="fa fa-check"></i><b>6</b> Functions, loops, and <code>apply</code></a><ul>
<li class="chapter" data-level="6.1" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#writing-basic-functions"><i class="fa fa-check"></i><b>6.2</b> Writing basic functions</a></li>
<li class="chapter" data-level="6.3" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#using-apply-functions"><i class="fa fa-check"></i><b>6.3</b> Using <code>apply</code> functions</a><ul>
<li class="chapter" data-level="6.3.1" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#apply"><i class="fa fa-check"></i><b>6.3.1</b> <code>apply</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#sapply"><i class="fa fa-check"></i><b>6.3.2</b> <code>sapply</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#lapply"><i class="fa fa-check"></i><b>6.3.3</b> <code>lapply</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#mapply"><i class="fa fa-check"></i><b>6.3.4</b> <code>mapply</code></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="functions-loops-and-apply.html"><a href="functions-loops-and-apply.html#loops"><i class="fa fa-check"></i><b>6.4</b> Loops</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html"><i class="fa fa-check"></i><b>7</b> Spatial tools for forestry and ecological applications</a><ul>
<li class="chapter" data-level="7.1" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#an-introduction-to-processing-lidar-data-in-r"><i class="fa fa-check"></i><b>7.1</b> An introduction to processing LiDAR data in <code>R</code></a></li>
<li class="chapter" data-level="7.2" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#working-with-lidar-data-in-r"><i class="fa fa-check"></i><b>7.2</b> Working with LiDAR data in R</a></li>
<li class="chapter" data-level="7.3" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#step-1.-loading-and-visualizing-pointclouds"><i class="fa fa-check"></i><b>7.3</b> Step 1. Loading and visualizing pointclouds</a></li>
<li class="chapter" data-level="7.4" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#step-2.-computing-a-canopy-height-model"><i class="fa fa-check"></i><b>7.4</b> Step 2. Computing a canopy height model</a><ul>
<li class="chapter" data-level="7.4.1" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#ground-detection-and-normalizing-a-point-cloud"><i class="fa fa-check"></i><b>7.4.1</b> Ground detection and normalizing a point cloud</a></li>
<li class="chapter" data-level="7.4.2" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#building-the-initial-chm"><i class="fa fa-check"></i><b>7.4.2</b> Building the initial CHM</a></li>
<li class="chapter" data-level="7.4.3" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-1"><i class="fa fa-check"></i><b>7.4.3</b> Challenge 1</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#step-3.-individual-tree-segmentation"><i class="fa fa-check"></i><b>7.5</b> Step 3. Individual tree segmentation</a><ul>
<li class="chapter" data-level="7.5.1" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#delineating-the-crowns"><i class="fa fa-check"></i><b>7.5.1</b> Delineating the crowns</a></li>
<li class="chapter" data-level="7.5.2" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-2"><i class="fa fa-check"></i><b>7.5.2</b> Challenge 2</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#additional-analysis-computing-a-digital-terrain-model-dtm"><i class="fa fa-check"></i><b>7.6</b> Additional analysis: Computing a digital terrain model (DTM)</a><ul>
<li class="chapter" data-level="7.6.1" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-3"><i class="fa fa-check"></i><b>7.6.1</b> Challenge 3</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#wrapping-up"><i class="fa fa-check"></i><b>7.7</b> Wrapping up</a></li>
<li class="chapter" data-level="7.8" data-path="spatial-tools-for-forestry-and-ecological-applications.html"><a href="spatial-tools-for-forestry-and-ecological-applications.html#solutions-to-the-challenges"><i class="fa fa-check"></i><b>7.8</b> Solutions to the challenges</a><ul>
<li class="chapter" data-level="7.8.1" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-1-1"><i class="fa fa-check"></i><b>7.8.1</b> Challenge 1</a></li>
<li class="chapter" data-level="7.8.2" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-2-1"><i class="fa fa-check"></i><b>7.8.2</b> Challenge 2</a></li>
<li class="chapter" data-level="7.8.3" data-path="dplyr-a-brief-introduction-to-tidy-data-manipulation.html"><a href="dplyr-a-brief-introduction-to-tidy-data-manipulation.html#challenge-3-1"><i class="fa fa-check"></i><b>7.8.3</b> Challenge 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html"><i class="fa fa-check"></i><b>8</b> Calculating class area from raster</a><ul>
<li class="chapter" data-level="8.1" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html#simple-area-and-area-fraction-calculations-on-a-classified-raster"><i class="fa fa-check"></i><b>8.1</b> Simple area and area fraction calculations on a classified raster</a><ul>
<li class="chapter" data-level="8.1.1" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html#creating-dummy-data"><i class="fa fa-check"></i><b>8.1.1</b> Creating dummy data</a></li>
<li class="chapter" data-level="8.1.2" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html#preparing-the-raster-for-area-calculation"><i class="fa fa-check"></i><b>8.1.2</b> Preparing the raster for area calculation</a></li>
<li class="chapter" data-level="8.1.3" data-path="calculating-class-area-from-raster.html"><a href="calculating-class-area-from-raster.html#compiling-a-comprehensive-table"><i class="fa fa-check"></i><b>8.1.3</b> Compiling a comprehensive table</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><i class="fa fa-check"></i><b>9</b> Extracting raster fractions and area using a polygon mask</a><ul>
<li class="chapter" data-level="9.1" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#problem-statement"><i class="fa fa-check"></i><b>9.1</b> Problem statement</a></li>
<li class="chapter" data-level="9.2" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#creating-some-dummy-raster-data"><i class="fa fa-check"></i><b>9.2</b> Creating some dummy raster data</a></li>
<li class="chapter" data-level="9.3" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#create-some-reserves"><i class="fa fa-check"></i><b>9.3</b> Create some reserves</a></li>
<li class="chapter" data-level="9.4" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#extracting-data"><i class="fa fa-check"></i><b>9.4</b> Extracting data</a></li>
<li class="chapter" data-level="9.5" data-path="extracting-raster-fractions-and-area-using-a-polygon-mask.html"><a href="extracting-raster-fractions-and-area-using-a-polygon-mask.html#plotting-the-results"><i class="fa fa-check"></i><b>9.5</b> Plotting the results</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro to R for Forest Ecosystem Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="working-with-spatial-data-in-r" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Working with spatial data in <code>R</code></h1>
<p>Many of you will be familiar with using spatial data such as vector data in form of shapefiles or raster data in GIS software, which can handle these files intuitively. Nevertheless, GIS do have some disadvantages when it comes to either large data sets or automation processes. <code>R</code> offers a full integration of spatial tools and references such as <strong>GDAL</strong> or <strong>PROJ</strong> and some great packages to deal with this data seamlessly. Today we are going to learn how to use the package <code>sf</code> and have a brief detour towards raster data in <code>R</code>. You are going to need to install the following packages for this tutorial:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="working-with-spatial-data-in-r.html#cb111-1"></a><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">&#39;tidyverse&#39;</span>, <span class="st">&#39;sf&#39;</span>, <span class="st">&#39;raster&#39;</span>, <span class="st">&#39;viridis&#39;</span>))</span></code></pre></div>
<p>And then call the packages:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="working-with-spatial-data-in-r.html#cb112-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb112-2"><a href="working-with-spatial-data-in-r.html#cb112-2"></a><span class="kw">library</span>(raster)</span>
<span id="cb112-3"><a href="working-with-spatial-data-in-r.html#cb112-3"></a><span class="kw">library</span>(viridis)</span>
<span id="cb112-4"><a href="working-with-spatial-data-in-r.html#cb112-4"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<p>We will be working on a dataset of koala observations, that you can download <a href="https://www.dropbox.com/s/1zhru8ui3btmg0n/koala.csv?dl=1">here</a>, as well as a basic administrative Areas shapefile of Australia, which you can find <a href="https://www.dropbox.com/s/7edsxu5eezrzrqu/Australia.rar?dl=1">here</a>. For the last part we will be looking at rasters, with a digital elevation model (DEM) file as example. You can find it for download <a href="https://www.dropbox.com/s/u2j6a73t7nv0lww/DEM.tif?dl=0">here</a>. Please make sure these are stored within a <code>data/</code> folder in an <code>R</code> project (or working directory).</p>
<div id="transforming-a-dataset-into-an-sf-object" class="section level2">
<h2><span class="header-section-number">5.1</span> Transforming a dataset into an <code>sf</code> object</h2>
<p>Let’s first load in our dataset and have a look at it’s structure</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="working-with-spatial-data-in-r.html#cb113-1"></a>koala &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/koala.csv&#39;</span>)</span>
<span id="cb113-2"><a href="working-with-spatial-data-in-r.html#cb113-2"></a></span>
<span id="cb113-3"><a href="working-with-spatial-data-in-r.html#cb113-3"></a><span class="kw">head</span>(koala) <span class="co"># see the first few rows in the console</span></span></code></pre></div>
<pre><code>##                  species        X         Y      state   region    sex   weight
## 1 Phascolarctos cinereus 153.2155 -27.49284 Queensland northern   male 7.119754
## 2 Phascolarctos cinereus 148.1443 -22.47617 Queensland northern female 5.451345
## 3 Phascolarctos cinereus 153.2285 -27.50298 Queensland northern   male 6.630577
## 4 Phascolarctos cinereus 152.6000 -27.50000 Queensland northern   male 6.470019
## 5 Phascolarctos cinereus 153.2817 -27.52589 Queensland northern female 5.620447
## 6 Phascolarctos cinereus 152.8330 -27.20000 Queensland northern   male 7.287674
##       size      fur     tail age      color joey        behav           obs
## 1 70.80159 1.858696 1.168241   8       grey   No     Sleeping  Spotlighting
## 2 70.38537 1.852801 1.562456  10 grey-brown  Yes     Sleeping Opportunistic
## 3 68.65867 2.479280 1.056640   1 light grey   No Just Chillin  Spotlighting
## 4 72.98919 1.923974 1.801244   1       grey   No     Sleeping  Stagwatching
## 5 65.19529 1.945341 1.625600  10 grey-brown   No     Sleeping  Stagwatching
## 6 70.56514 1.688897 1.086675  12 grey-brown   No      Feeding Opportunistic</code></pre>
<p>As we can see it contains lots of variables related to each of the observed koalas, such as <code>sex</code>, <code>weight</code> or in which <code>state</code> the observation was made. Additionally, whoever collected this data was so kind to also include the <code>X</code> and <code>Y</code> coordinates, where the observation was made. This we can use to transform this into an <code>sf</code> (simple feature) object.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="working-with-spatial-data-in-r.html#cb115-1"></a>koala_sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(koala, </span>
<span id="cb115-2"><a href="working-with-spatial-data-in-r.html#cb115-2"></a>                     <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, </span>
<span id="cb115-3"><a href="working-with-spatial-data-in-r.html#cb115-3"></a>                                <span class="st">&quot;Y&quot;</span>), </span>
<span id="cb115-4"><a href="working-with-spatial-data-in-r.html#cb115-4"></a>                     <span class="dt">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb115-5"><a href="working-with-spatial-data-in-r.html#cb115-5"></a><span class="kw">str</span>(koala_sf)</span></code></pre></div>
<pre><code>## Classes &#39;sf&#39; and &#39;data.frame&#39;:	242 obs. of  14 variables:
##  $ species : Factor w/ 1 level &quot;Phascolarctos cinereus&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ state   : Factor w/ 4 levels &quot;New South Wales&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ region  : Factor w/ 2 levels &quot;northern&quot;,&quot;southern&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ sex     : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 2 1 2 2 1 2 2 2 1 1 ...
##  $ weight  : num  7.12 5.45 6.63 6.47 5.62 ...
##  $ size    : num  70.8 70.4 68.7 73 65.2 ...
##  $ fur     : num  1.86 1.85 2.48 1.92 1.95 ...
##  $ tail    : num  1.17 1.56 1.06 1.8 1.63 ...
##  $ age     : int  8 10 1 1 10 12 9 1 1 1 ...
##  $ color   : Factor w/ 6 levels &quot;chocolate brown&quot;,..: 3 4 6 3 4 4 6 4 3 3 ...
##  $ joey    : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 2 1 1 1 1 1 1 1 1 ...
##  $ behav   : Factor w/ 3 levels &quot;Feeding&quot;,&quot;Just Chillin&quot;,..: 3 3 2 3 3 1 2 3 1 3 ...
##  $ obs     : Factor w/ 3 levels &quot;Opportunistic&quot;,..: 2 1 2 3 3 1 3 2 2 2 ...
##  $ geometry:sfc_POINT of length 242; first list element:  &#39;XY&#39; num  153.2 -27.5
##  - attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot;
##  - attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA NA NA NA NA NA NA NA NA ...
##   ..- attr(*, &quot;names&quot;)= chr  &quot;species&quot; &quot;state&quot; &quot;region&quot; &quot;sex&quot; ...</code></pre>
<p>The <code>sf</code> object is a <code>data.frame</code> with a <em>geometry list-column</em>. It supports different format and spatial references. The file as it exists in your <code>R</code> environment is what you would call the <em>Attribute table</em> in a GIS software. In <code>R</code> you can use and manipulate it as any other <code>data.frame</code>. When converting a table into a <code>sf</code> we need to indicate the columns containing coordinates using <code>coords = c()</code> and we can decide on a coordinate reference system using <code>crs=</code>. Here we decide to use WGS84 (CRS = 4326), a standard Mercator coordinate frame for the Earth given in Latitude and Longitude. We can plot our now spatial data with the standard base R command:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="working-with-spatial-data-in-r.html#cb117-1"></a><span class="kw">plot</span>(koala_sf)</span></code></pre></div>
<pre><code>## Warning: plotting the first 10 out of 13 attributes; use max.plot = 13 to plot
## all</code></pre>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>This will try to plot all columns (because they are now all spatially referenced). To only plot the geometries, you can:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="working-with-spatial-data-in-r.html#cb119-1"></a><span class="kw">plot</span>(koala_sf<span class="op">$</span>geometry)</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>So far so good, but we will need a bit more data to make a nice map!</p>
</div>
<div id="loading-shapefiles-into-r-transforming-and-plotting" class="section level2">
<h2><span class="header-section-number">5.2</span> Loading shapefiles into <code>R</code>, transforming and plotting</h2>
<p>You can load any vector file, such as .shp or .gpkg using <code>st_read</code>. Let’s get our Australia map into the environment and check it out:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="working-with-spatial-data-in-r.html#cb120-1"></a>states &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/Australia/Australia_proj.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `Australia_proj&#39; from data source `E:\Github\forest-ecology-R-book\data\Australia\Australia_proj.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 8 features and 15 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -2063975 ymin: -4965263 xmax: 1891143 ymax: -1285856
## projected CRS:  GDA94 / Geoscience Australia Lambert</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="working-with-spatial-data-in-r.html#cb122-1"></a><span class="kw">plot</span>(states<span class="op">$</span>geometry)</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Great, we even have states column, which will we will use a bit later. To plot, simply use base <code>R</code> syntax of plotting and then plotting another graph on top using <code>add = T</code>. Instead of calling <code>plot(file$geometry)</code>, we can also call <code>st_geometry()</code></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="working-with-spatial-data-in-r.html#cb123-1"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(states), </span>
<span id="cb123-2"><a href="working-with-spatial-data-in-r.html#cb123-2"></a>     <span class="dt">axes =</span> <span class="ot">TRUE</span>)</span>
<span id="cb123-3"><a href="working-with-spatial-data-in-r.html#cb123-3"></a></span>
<span id="cb123-4"><a href="working-with-spatial-data-in-r.html#cb123-4"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(koala_sf), <span class="co"># why does this not work?</span></span>
<span id="cb123-5"><a href="working-with-spatial-data-in-r.html#cb123-5"></a>     <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb123-6"><a href="working-with-spatial-data-in-r.html#cb123-6"></a>     <span class="dt">add =</span> T)</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Hm, our states are plotting fine, but where are our koala locations? Maybe we should check the coordinate reference system to see if they match… Here’s how that’s done:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="working-with-spatial-data-in-r.html#cb124-1"></a><span class="kw">st_crs</span>(states)</span></code></pre></div>
<pre><code>## Coordinate Reference System:
##   User input: GDA94 / Geoscience Australia Lambert 
##   wkt:
## PROJCRS[&quot;GDA94 / Geoscience Australia Lambert&quot;,
##     BASEGEOGCRS[&quot;GDA94&quot;,
##         DATUM[&quot;Geocentric Datum of Australia 1994&quot;,
##             ELLIPSOID[&quot;GRS 1980&quot;,6378137,298.257222101,
##                 LENGTHUNIT[&quot;metre&quot;,1]]],
##         PRIMEM[&quot;Greenwich&quot;,0,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##         ID[&quot;EPSG&quot;,4283]],
##     CONVERSION[&quot;Geoscience Australia Standard National Scale Lambert Projection&quot;,
##         METHOD[&quot;Lambert Conic Conformal (2SP)&quot;,
##             ID[&quot;EPSG&quot;,9802]],
##         PARAMETER[&quot;Latitude of false origin&quot;,0,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##             ID[&quot;EPSG&quot;,8821]],
##         PARAMETER[&quot;Longitude of false origin&quot;,134,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##             ID[&quot;EPSG&quot;,8822]],
##         PARAMETER[&quot;Latitude of 1st standard parallel&quot;,-18,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##             ID[&quot;EPSG&quot;,8823]],
##         PARAMETER[&quot;Latitude of 2nd standard parallel&quot;,-36,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##             ID[&quot;EPSG&quot;,8824]],
##         PARAMETER[&quot;Easting at false origin&quot;,0,
##             LENGTHUNIT[&quot;metre&quot;,1],
##             ID[&quot;EPSG&quot;,8826]],
##         PARAMETER[&quot;Northing at false origin&quot;,0,
##             LENGTHUNIT[&quot;metre&quot;,1],
##             ID[&quot;EPSG&quot;,8827]]],
##     CS[Cartesian,2],
##         AXIS[&quot;(E)&quot;,east,
##             ORDER[1],
##             LENGTHUNIT[&quot;metre&quot;,1]],
##         AXIS[&quot;(N)&quot;,north,
##             ORDER[2],
##             LENGTHUNIT[&quot;metre&quot;,1]],
##     USAGE[
##         SCOPE[&quot;unknown&quot;],
##         AREA[&quot;Australia - onshore&quot;],
##         BBOX[-43.7,112.85,-9.86,153.69]],
##     ID[&quot;EPSG&quot;,3112]]</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="working-with-spatial-data-in-r.html#cb126-1"></a><span class="kw">st_crs</span>(koala_sf)</span></code></pre></div>
<pre><code>## Coordinate Reference System:
##   User input: EPSG:4326 
##   wkt:
## GEOGCRS[&quot;WGS 84&quot;,
##     DATUM[&quot;World Geodetic System 1984&quot;,
##         ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##             LENGTHUNIT[&quot;metre&quot;,1]]],
##     PRIMEM[&quot;Greenwich&quot;,0,
##         ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     CS[ellipsoidal,2],
##         AXIS[&quot;geodetic latitude (Lat)&quot;,north,
##             ORDER[1],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##         AXIS[&quot;geodetic longitude (Lon)&quot;,east,
##             ORDER[2],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     USAGE[
##         SCOPE[&quot;unknown&quot;],
##         AREA[&quot;World&quot;],
##         BBOX[-90,-180,90,180]],
##     ID[&quot;EPSG&quot;,4326]]</code></pre>
<p>Damn, they do not match. Our Australia shapefile has a different (weird) projection. If you feel it’s tedious to check the CRS in the console, simply type</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="working-with-spatial-data-in-r.html#cb128-1"></a><span class="kw">st_crs</span>(states)<span class="op">==</span><span class="kw">st_crs</span>(koala_sf)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p><code>FALSE</code> is returned, so they don’t match. We need to transform one of them to be able to plot our spatial points on top of the Australia map. <code>sf</code> has a simple solution for this using <code>st_transform()</code>. Let’s do that and plot straight away.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="working-with-spatial-data-in-r.html#cb130-1"></a>koala_proj &lt;-<span class="st"> </span><span class="kw">st_transform</span>(koala_sf, <span class="dt">crs =</span> <span class="kw">st_crs</span>(states))</span>
<span id="cb130-2"><a href="working-with-spatial-data-in-r.html#cb130-2"></a></span>
<span id="cb130-3"><a href="working-with-spatial-data-in-r.html#cb130-3"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(states), </span>
<span id="cb130-4"><a href="working-with-spatial-data-in-r.html#cb130-4"></a>     <span class="dt">axes =</span> <span class="ot">TRUE</span>)</span>
<span id="cb130-5"><a href="working-with-spatial-data-in-r.html#cb130-5"></a></span>
<span id="cb130-6"><a href="working-with-spatial-data-in-r.html#cb130-6"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(koala_proj), </span>
<span id="cb130-7"><a href="working-with-spatial-data-in-r.html#cb130-7"></a>     <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb130-8"><a href="working-with-spatial-data-in-r.html#cb130-8"></a>     <span class="dt">add =</span> T)</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Excellent! In <code>st_transform</code> we can call any <code>crs</code> from another spatial file in the environment, our define our own using a <code>proj4string</code>. If we look at our plot, we can see that the coordinates on the axis look weird. We’d rather like latitude and longitude to make it look more comprehensive. That’s now up to you to fix it!</p>
<div id="challenge-1" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Challenge 1</h3>
<p><strong>Load the Australia_proj and koala data again and plot them on top of each other in Mercator projection (CRS: 4326). Note: check the spatial reference of the maps first!</strong></p>
<p><em>Extra challenge: color the koala points based on state! Check <code>?sf::plot</code> for tips</em></p>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Looks good! You can find the solutions to all challenges posed here at the end of the document. Don’t peek!</p>
<p>Let’s make our maps look even better.</p>
</div>
</div>
<div id="simple-geometric-operations" class="section level2">
<h2><span class="header-section-number">5.3</span> Simple geometric operations</h2>
<p><code>sf</code> supports any geometric operations you know from GIS software. We will just touch cropping here, but you can also merge, intersect, overlap and many more. For the purpose of mapping, <code>st_crop()</code> is most relevant. Let’s say we want to create a map of all our Koala locations, we won’t necessarily need to show all of Australia, knowing that Koalas are only distributed along the east coast. Let’s crop the Australia shapefile by the extent of our observations:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="working-with-spatial-data-in-r.html#cb131-1"></a>australia_koala_area&lt;-<span class="kw">st_crop</span>(states_proj, koala_sf)</span></code></pre></div>
<pre><code>## although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout all
## geometries</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="working-with-spatial-data-in-r.html#cb134-1"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(australia_koala_area), <span class="dt">axes =</span> T)</span>
<span id="cb134-2"><a href="working-with-spatial-data-in-r.html#cb134-2"></a></span>
<span id="cb134-3"><a href="working-with-spatial-data-in-r.html#cb134-3"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(koala_sf), <span class="dt">add =</span> T)</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Great. Let’s say we want to save the new cropped shapefile to an <code>outputs/</code> folder in our project. For this we simply use <code>st_write()</code>:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="working-with-spatial-data-in-r.html#cb135-1"></a><span class="kw">st_write</span>(australia_koala_area, <span class="st">&#39;outputs/koala_shape.gpkg&#39;</span>)</span></code></pre></div>
<p>You can choose different file extensions. Here we are saving a geopackage, as it results in only one file, rather than 4-6 for a .shp extension. Up to you ;) Let’s make a good looking map with our data!</p>
</div>
<div id="making-a-map-using-ggplot2" class="section level2">
<h2><span class="header-section-number">5.4</span> Making a map using <code>ggplot2</code></h2>
<p><code>ggplot2</code> supports plotting spatial data by calling <code>geom_sf()</code>, after defining your data to plot. In simple terms we can create a map of Australia by calling:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="working-with-spatial-data-in-r.html#cb136-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> states_proj) <span class="op">+</span><span class="st"> </span><span class="kw">geom_sf</span>()</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>which already looks a lot better than base R. But there are a lot of improvements to be made to create a publication-ready map. First we can assign colors based on columns in your data. We can also remove the standard grey ggplot background with a more map-friendly white grid using <code>theme_minimal()</code></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="working-with-spatial-data-in-r.html#cb137-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> states_proj)<span class="op">+</span></span>
<span id="cb137-2"><a href="working-with-spatial-data-in-r.html#cb137-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> STATENAME))<span class="op">+</span></span>
<span id="cb137-3"><a href="working-with-spatial-data-in-r.html#cb137-3"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>We don’t really need a legend here, let’s remove it:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="working-with-spatial-data-in-r.html#cb138-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> states_proj)<span class="op">+</span></span>
<span id="cb138-2"><a href="working-with-spatial-data-in-r.html#cb138-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> STATENAME))<span class="op">+</span></span>
<span id="cb138-3"><a href="working-with-spatial-data-in-r.html#cb138-3"></a><span class="st">  </span><span class="kw">theme_minimal</span>()<span class="op">+</span></span>
<span id="cb138-4"><a href="working-with-spatial-data-in-r.html#cb138-4"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> F)</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Using <code>coord_sf()</code> we can even change the projection while plotting in <code>ggplot2</code>, without the need of going back to reprojecting or transforming in <code>sf</code>.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="working-with-spatial-data-in-r.html#cb139-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> states_proj)<span class="op">+</span></span>
<span id="cb139-2"><a href="working-with-spatial-data-in-r.html#cb139-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> STATENAME))<span class="op">+</span></span>
<span id="cb139-3"><a href="working-with-spatial-data-in-r.html#cb139-3"></a><span class="st">  </span><span class="kw">theme_minimal</span>()<span class="op">+</span></span>
<span id="cb139-4"><a href="working-with-spatial-data-in-r.html#cb139-4"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> F)<span class="op">+</span></span>
<span id="cb139-5"><a href="working-with-spatial-data-in-r.html#cb139-5"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">3112</span>)</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Did you see what changed? Finally we can change the fore- and background color to make it look like proper map in a nice blue ocean:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="working-with-spatial-data-in-r.html#cb140-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> states_proj)<span class="op">+</span></span>
<span id="cb140-2"><a href="working-with-spatial-data-in-r.html#cb140-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">size =</span> <span class="fl">0.3</span>, <span class="dt">fill =</span> <span class="st">&#39;white&#39;</span>)<span class="op">+</span></span>
<span id="cb140-3"><a href="working-with-spatial-data-in-r.html#cb140-3"></a><span class="st">  </span><span class="kw">theme_minimal</span>()<span class="op">+</span></span>
<span id="cb140-4"><a href="working-with-spatial-data-in-r.html#cb140-4"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">3112</span>)<span class="op">+</span></span>
<span id="cb140-5"><a href="working-with-spatial-data-in-r.html#cb140-5"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&#39;steelblue2&#39;</span>))</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<div id="challenge-2" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Challenge 2</h3>
<p><strong>Add the koala positions on top of the Australia map in ggplot2. Only plot the area that has koalas and color the points by sex of the individual. Please also give the map in Mercator projection</strong></p>
<p><em>You will need to:</em></p>
<ol style="list-style-type: decimal">
<li>Add a second layer to your ggplot</li>
<li>Define the crs</li>
</ol>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Good job! But unfortunately our cut-out looks like an island surrounded by seawater. If we want the map to look like a close-up of eastern Australia, we need to tell <code>ggplot2</code> to start plotting at x/y = 0:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="working-with-spatial-data-in-r.html#cb141-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> australia_koala_area)<span class="op">+</span></span>
<span id="cb141-2"><a href="working-with-spatial-data-in-r.html#cb141-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">size =</span> <span class="fl">0.3</span>, <span class="dt">fill =</span> <span class="st">&#39;white&#39;</span>)<span class="op">+</span></span>
<span id="cb141-3"><a href="working-with-spatial-data-in-r.html#cb141-3"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> koala_sf, <span class="dt">size =</span> <span class="dv">2</span>, <span class="kw">aes</span>(<span class="dt">color =</span> sex), <span class="dt">show.legend =</span> <span class="st">&quot;point&quot;</span>)<span class="op">+</span></span>
<span id="cb141-4"><a href="working-with-spatial-data-in-r.html#cb141-4"></a><span class="st">  </span><span class="kw">theme_minimal</span>()<span class="op">+</span></span>
<span id="cb141-5"><a href="working-with-spatial-data-in-r.html#cb141-5"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">4326</span>)<span class="op">+</span></span>
<span id="cb141-6"><a href="working-with-spatial-data-in-r.html#cb141-6"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&#39;steelblue2&#39;</span>))<span class="op">+</span></span>
<span id="cb141-7"><a href="working-with-spatial-data-in-r.html#cb141-7"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb141-8"><a href="working-with-spatial-data-in-r.html#cb141-8"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>When working with these types of maps, you will often be asked to create an inset map that shows the entire area that you cropped from for reference. Let’s add a little Australia shape with a bounding box of our study area to our map. First we need to create the a base map with bounding box and save it to the environment:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="working-with-spatial-data-in-r.html#cb142-1"></a>inset&lt;-<span class="kw">ggplot</span>(<span class="dt">data =</span> states_proj, <span class="dt">show.legend =</span> <span class="st">&quot;point&quot;</span>)<span class="op">+</span></span>
<span id="cb142-2"><a href="working-with-spatial-data-in-r.html#cb142-2"></a><span class="st">  </span><span class="kw">geom_sf</span>()<span class="op">+</span></span>
<span id="cb142-3"><a href="working-with-spatial-data-in-r.html#cb142-3"></a><span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">xmin =</span> <span class="kw">extent</span>(australia_koala_area)[<span class="dv">1</span>], <span class="dt">xmax =</span> <span class="kw">extent</span>(australia_koala_area)[<span class="dv">2</span>],</span>
<span id="cb142-4"><a href="working-with-spatial-data-in-r.html#cb142-4"></a>            <span class="dt">ymin =</span> <span class="kw">extent</span>(australia_koala_area)[<span class="dv">3</span>], <span class="dt">ymax =</span> <span class="kw">extent</span>(australia_koala_area)[<span class="dv">4</span>],</span>
<span id="cb142-5"><a href="working-with-spatial-data-in-r.html#cb142-5"></a>            <span class="dt">fill =</span> <span class="ot">NA</span>,  <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>)<span class="op">+</span></span>
<span id="cb142-6"><a href="working-with-spatial-data-in-r.html#cb142-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;&#39;</span>, <span class="dt">title =</span> <span class="st">&#39;&#39;</span>)<span class="op">+</span></span>
<span id="cb142-7"><a href="working-with-spatial-data-in-r.html#cb142-7"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">4326</span>)<span class="op">+</span></span>
<span id="cb142-8"><a href="working-with-spatial-data-in-r.html#cb142-8"></a><span class="st">  </span><span class="kw">theme_void</span>()</span>
<span id="cb142-9"><a href="working-with-spatial-data-in-r.html#cb142-9"></a></span>
<span id="cb142-10"><a href="working-with-spatial-data-in-r.html#cb142-10"></a>inset</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p><code>geom_rect</code> can create any rectangular shape within your ggplot based on <code>xmin</code>, <code>xmax</code> and so on. Since these are dependent on your scales, for mapping we can use the <code>extent</code> of our cropped area from before. <code>extent()</code> is part of the <code>raster</code> package:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="working-with-spatial-data-in-r.html#cb143-1"></a><span class="kw">extent</span>(australia_koala_area)</span></code></pre></div>
<pre><code>## class      : Extent 
## xmin       : 138.5795 
## xmax       : 153.5651 
## ymin       : -39 
## ymax       : -21.3906</code></pre>
<p>By using <code>[1]</code>, <code>[2]</code> and so on, we call the respective coordinate from the four rows that this function is giving us. Using <code>theme_void()</code> is getting rid of any axis and grids, so that we have the map only. We also need to save our map as an object:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="working-with-spatial-data-in-r.html#cb145-1"></a>map&lt;-<span class="kw">ggplot</span>(<span class="dt">data =</span> australia_koala_area)<span class="op">+</span></span>
<span id="cb145-2"><a href="working-with-spatial-data-in-r.html#cb145-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">size =</span> <span class="fl">0.3</span>, <span class="dt">fill =</span> <span class="st">&#39;white&#39;</span>)<span class="op">+</span></span>
<span id="cb145-3"><a href="working-with-spatial-data-in-r.html#cb145-3"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> koala_sf, <span class="dt">size =</span> <span class="dv">2</span>, <span class="kw">aes</span>(<span class="dt">color =</span> sex), <span class="dt">show.legend =</span> <span class="st">&quot;point&quot;</span>)<span class="op">+</span></span>
<span id="cb145-4"><a href="working-with-spatial-data-in-r.html#cb145-4"></a><span class="st">  </span><span class="kw">theme_minimal</span>()<span class="op">+</span></span>
<span id="cb145-5"><a href="working-with-spatial-data-in-r.html#cb145-5"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">4326</span>)<span class="op">+</span></span>
<span id="cb145-6"><a href="working-with-spatial-data-in-r.html#cb145-6"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&#39;steelblue2&#39;</span>))<span class="op">+</span><span class="st">  </span></span>
<span id="cb145-7"><a href="working-with-spatial-data-in-r.html#cb145-7"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb145-8"><a href="working-with-spatial-data-in-r.html#cb145-8"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code></pre></div>
<p>We use <code>annotation_custom()</code> and <code>ggplotGrob()</code> to place an inset into the main map:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="working-with-spatial-data-in-r.html#cb146-1"></a>map<span class="op">+</span><span class="kw">annotation_custom</span>(<span class="kw">ggplotGrob</span>(inset), <span class="dt">xmin =</span> <span class="dv">139</span>, <span class="dt">xmax =</span> <span class="dv">144</span>, <span class="dt">ymin =</span> <span class="dv">-26</span>, <span class="dt">ymax =</span> <span class="dv">-20</span>)</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>The size and position here is defined by <code>xmin =</code> etc. This needs a bit of fiddling around to get it right. Also be mindful that we are using a Mercator projection here and are in the southern hemisphere, so our <code>ymin</code> and <code>ymax</code> values need to be given in negative form. Now this is a proper map, ready to be put in your next publication! We will briefly talk about rasters, because you are likely to use them if you are working with shapefiles anyway. It is similarly easy to work with rasters in <code>R</code>:</p>
</div>
</div>
<div id="r-raster-basics" class="section level2">
<h2><span class="header-section-number">5.5</span> <code>R</code> raster basics</h2>
<p>Raster support in <code>R</code> is made available using the package <code>raster</code>. One called, we can load and plot a raster using the same command. Let’s get our DEM to play with:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="working-with-spatial-data-in-r.html#cb147-1"></a>dem&lt;-<span class="kw">raster</span>(<span class="st">&#39;data/DEM.tif&#39;</span>)</span></code></pre></div>
<pre><code>## Warning in showSRID(uprojargs, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;): Discarded
## datum Unknown based on GRS80 ellipsoid in CRS definition</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="working-with-spatial-data-in-r.html#cb149-1"></a><span class="kw">summary</span>(dem)</span></code></pre></div>
<pre><code>## Warning in .local(object, ...): summary is an estimate based on a sample of 1e+05 cells (21.51% of all cells)</code></pre>
<pre><code>##                 DEM
## Min.        0.00000
## 1st Qu.    89.28996
## Median    157.82292
## 3rd Qu.   400.73164
## Max.     2099.59570
## NA&#39;s    76084.00000</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="working-with-spatial-data-in-r.html#cb152-1"></a><span class="kw">plot</span>(dem)</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>In a raster, cell (or pixel) has a spatial reference and a value. In this case we have the elevation in meters for each degree (0.01, 0.01) in southeastern Australia.</p>
<p>Let’s say we’re only interested in Victoria. We can use a spatial vector to mask out the state area from the raster. First we need to create a mask. We already know that our Australia shapefile contains a <code>STATE</code> column. We can use that to subset the shapefile and use the subset as a mask. Simple <code>dplyr</code> commands and <code>%&gt;%</code> work on <code>sf</code> features, which makes working with them so easy in <code>R</code>!</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="working-with-spatial-data-in-r.html#cb153-1"></a>vic&lt;-states_proj<span class="op">%&gt;%</span><span class="kw">filter</span>(STATENAME <span class="op">==</span><span class="st"> &#39;Victoria&#39;</span>)<span class="op">%&gt;%</span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(dem)) <span class="co"># we also transform the crs to be sure they match</span></span>
<span id="cb153-2"><a href="working-with-spatial-data-in-r.html#cb153-2"></a></span>
<span id="cb153-3"><a href="working-with-spatial-data-in-r.html#cb153-3"></a><span class="kw">plot</span>(dem)</span>
<span id="cb153-4"><a href="working-with-spatial-data-in-r.html#cb153-4"></a><span class="kw">plot</span>(vic<span class="op">$</span>geometry, <span class="dt">add =</span> T)</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>To remove anything outside of Victoria, we use <code>raster</code>’s <code>mask()</code> and end up with the DEM for Victoria only:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="working-with-spatial-data-in-r.html#cb154-1"></a>dem_vic&lt;-<span class="kw">mask</span>(dem, vic)</span></code></pre></div>
<pre><code>## Warning in showSRID(uprojargs, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;): Discarded
## datum Unknown based on GRS80 ellipsoid in CRS definition</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="working-with-spatial-data-in-r.html#cb156-1"></a><span class="kw">plot</span>(dem_vic)</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>We can now also filter our koala dataset to only have koalas in Victoria to plot over our DEM.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="working-with-spatial-data-in-r.html#cb157-1"></a>koala_vic&lt;-koala_sf<span class="op">%&gt;%</span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &#39;Victoria&#39;</span>)<span class="op">%&gt;%</span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(dem))</span>
<span id="cb157-2"><a href="working-with-spatial-data-in-r.html#cb157-2"></a></span>
<span id="cb157-3"><a href="working-with-spatial-data-in-r.html#cb157-3"></a><span class="kw">plot</span>(dem_vic)</span>
<span id="cb157-4"><a href="working-with-spatial-data-in-r.html#cb157-4"></a></span>
<span id="cb157-5"><a href="working-with-spatial-data-in-r.html#cb157-5"></a><span class="kw">plot</span>(koala_vic<span class="op">$</span>geometry, <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">add =</span> T)</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>Often we are using rasters and spatial vector data together to extract data that is generally stored in raster form (such as elevation, mean temperatures or other topographic variables). For example if we are interested to see at which elevation our Koalas were observed in Victoria to make assumptions about their habitat preferences or temperature tolerances. If the CRS of both the raster and shapefile match, we can use <code>extract()</code> to add data from the raster to our spatial points as a new column:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="working-with-spatial-data-in-r.html#cb158-1"></a>koala_vic<span class="op">$</span>ele&lt;-raster<span class="op">::</span><span class="kw">extract</span>(dem_vic, koala_vic)</span></code></pre></div>
<pre><code>## Warning in showSRID(uprojargs, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;): Discarded
## datum Unknown based on GRS80 ellipsoid in CRS definition</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="working-with-spatial-data-in-r.html#cb160-1"></a><span class="kw">summary</span>(koala_vic<span class="op">$</span>ele)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   16.62   67.95  185.34  218.54  349.87  648.06</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="working-with-spatial-data-in-r.html#cb162-1"></a><span class="kw">hist</span>(koala_vic<span class="op">$</span>ele)</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>We can see most observations were made below 200 meters. The median elevation for koalas in our dataset was 185. Again if we want to make nice and informative maps out of rasters, even in combination with spatial vector data, <code>ggplot2</code> is the way to go!</p>
</div>
<div id="plotting-rasters-in-ggplot2" class="section level2">
<h2><span class="header-section-number">5.6</span> Plotting rasters in <code>ggplot2</code></h2>
<p>Before we can plot a raster, we have to make it into a <code>data.frame</code> containing of columns <code>X</code> and <code>Y</code> as coordinates and a column containing the raster value of each pixel. Since rasters can be large and the resulting dataframes even larger, we first take a sample of the raster, which reduces the resolution:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="working-with-spatial-data-in-r.html#cb163-1"></a>sample_raster&lt;-<span class="kw">sampleRegular</span>(dem_vic, <span class="dt">size =</span> <span class="fl">5e5</span>, <span class="dt">asRaster =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb163-2"><a href="working-with-spatial-data-in-r.html#cb163-2"></a><span class="st">  </span><span class="kw">as.data.frame</span>(<span class="dt">xy =</span> <span class="ot">TRUE</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)<span class="op">%&gt;%</span></span>
<span id="cb163-3"><a href="working-with-spatial-data-in-r.html#cb163-3"></a><span class="st">  </span><span class="kw">setNames</span>(<span class="kw">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>, <span class="st">&#39;layer&#39;</span>))</span></code></pre></div>
<p>Make sure to always use <code>xy = TRUE</code>, so that the coordinates are included in the new <code>data.frame</code>. We now have a format that ggplot can work with using <code>geom_raster()</code></p>
<pre><code>##             x        y    layer
## 902  140.9675 -33.9925 19.73859
## 1803 140.9675 -34.0025 48.89558
## 1804 140.9775 -34.0025 25.70812
## 2704 140.9675 -34.0125 53.28782
## 2705 140.9775 -34.0125 27.96507
## 2706 140.9875 -34.0125 20.13142</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="working-with-spatial-data-in-r.html#cb165-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> sample_raster, <span class="kw">aes</span> ( <span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> layer))<span class="op">+</span></span>
<span id="cb165-2"><a href="working-with-spatial-data-in-r.html#cb165-2"></a><span class="st">  </span><span class="kw">geom_raster</span>()</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Let’s make it look a bit prettier. The package <code>viridis</code> offers a few great color palettes for gradients of continuous variables:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="working-with-spatial-data-in-r.html#cb166-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> sample_raster, <span class="kw">aes</span> ( <span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> layer))<span class="op">+</span></span>
<span id="cb166-2"><a href="working-with-spatial-data-in-r.html#cb166-2"></a><span class="st">  </span><span class="kw">geom_raster</span>()<span class="op">+</span></span>
<span id="cb166-3"><a href="working-with-spatial-data-in-r.html#cb166-3"></a><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">option =</span> <span class="st">&#39;A&#39;</span>)<span class="op">+</span></span>
<span id="cb166-4"><a href="working-with-spatial-data-in-r.html#cb166-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Longitude&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;Latitude&#39;</span>, <span class="dt">fill =</span> <span class="st">&#39;Elevation&#39;</span>)<span class="op">+</span></span>
<span id="cb166-5"><a href="working-with-spatial-data-in-r.html#cb166-5"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">4326</span>)<span class="op">+</span></span>
<span id="cb166-6"><a href="working-with-spatial-data-in-r.html#cb166-6"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>We can plot additional layers on top of the raster by adding more <code>geom_</code>’s. That means we can plot rasters and spatial vectors together to make great maps for your papers and reports. I’m sure you can figure it out yourself for the next and final challenge!</p>
<div id="challenge-3" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Challenge 3</h3>
<p><strong>Add koala observations, color points by a categorical variable of your choice and change the color scheme.</strong></p>
<p><em>hint: to add different types of data, each data layer needs its own data source!:</em>
<em>(geom_raster(data = sample_raster, aes(x = x, y = y, fill = layer))+…</em>)</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="working-with-spatial-data-in-r.html#cb167-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb167-2"><a href="working-with-spatial-data-in-r.html#cb167-2"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> sample_raster, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> layer))<span class="op">+</span></span>
<span id="cb167-3"><a href="working-with-spatial-data-in-r.html#cb167-3"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>koala_vic, <span class="dt">size =</span> <span class="dv">2</span>, <span class="kw">aes</span>(<span class="dt">color =</span> sex), <span class="dt">show.legend =</span> <span class="st">&quot;point&quot;</span>)<span class="op">+</span></span>
<span id="cb167-4"><a href="working-with-spatial-data-in-r.html#cb167-4"></a><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">option =</span> <span class="st">&quot;D&quot;</span>) <span class="op">+</span></span>
<span id="cb167-5"><a href="working-with-spatial-data-in-r.html#cb167-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Longitude&quot;</span>, </span>
<span id="cb167-6"><a href="working-with-spatial-data-in-r.html#cb167-6"></a>       <span class="dt">y =</span> <span class="st">&quot;Latitude&quot;</span>, </span>
<span id="cb167-7"><a href="working-with-spatial-data-in-r.html#cb167-7"></a>       <span class="dt">fill =</span> <span class="st">&quot;Elevation&quot;</span>) <span class="op">+</span></span>
<span id="cb167-8"><a href="working-with-spatial-data-in-r.html#cb167-8"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">+</span></span>
<span id="cb167-9"><a href="working-with-spatial-data-in-r.html#cb167-9"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="03-spatial_tut_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
</div>
</div>
<div id="solutions-to-challenges" class="section level2">
<h2><span class="header-section-number">5.7</span> Solutions to Challenges</h2>
<div id="challenge-1-1" class="section level3">
<h3><span class="header-section-number">5.7.1</span> Challenge 1</h3>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="working-with-spatial-data-in-r.html#cb168-1"></a>states_proj &lt;-<span class="st"> </span><span class="kw">st_transform</span>(states, <span class="dt">crs =</span> <span class="kw">st_crs</span>(koala_sf))</span>
<span id="cb168-2"><a href="working-with-spatial-data-in-r.html#cb168-2"></a></span>
<span id="cb168-3"><a href="working-with-spatial-data-in-r.html#cb168-3"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(states_proj), </span>
<span id="cb168-4"><a href="working-with-spatial-data-in-r.html#cb168-4"></a>     <span class="dt">axes =</span> <span class="ot">TRUE</span>)</span>
<span id="cb168-5"><a href="working-with-spatial-data-in-r.html#cb168-5"></a></span>
<span id="cb168-6"><a href="working-with-spatial-data-in-r.html#cb168-6"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(koala_sf), </span>
<span id="cb168-7"><a href="working-with-spatial-data-in-r.html#cb168-7"></a>     <span class="dt">col =</span> koala_sf<span class="op">$</span>state, </span>
<span id="cb168-8"><a href="working-with-spatial-data-in-r.html#cb168-8"></a>     <span class="dt">add =</span> T)</span></code></pre></div>
</div>
<div id="challenge-2-1" class="section level3">
<h3><span class="header-section-number">5.7.2</span> Challenge 2</h3>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="working-with-spatial-data-in-r.html#cb169-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> australia_koala_area)<span class="op">+</span></span>
<span id="cb169-2"><a href="working-with-spatial-data-in-r.html#cb169-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">size =</span> <span class="fl">0.3</span>, <span class="dt">fill =</span> <span class="st">&#39;white&#39;</span>)<span class="op">+</span></span>
<span id="cb169-3"><a href="working-with-spatial-data-in-r.html#cb169-3"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> koala_sf, <span class="dt">size =</span> <span class="dv">2</span>, <span class="kw">aes</span>(<span class="dt">color =</span> sex))<span class="op">+</span></span>
<span id="cb169-4"><a href="working-with-spatial-data-in-r.html#cb169-4"></a><span class="st">  </span><span class="kw">theme_minimal</span>()<span class="op">+</span></span>
<span id="cb169-5"><a href="working-with-spatial-data-in-r.html#cb169-5"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">4326</span>)<span class="op">+</span></span>
<span id="cb169-6"><a href="working-with-spatial-data-in-r.html#cb169-6"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&#39;steelblue2&#39;</span>))</span></code></pre></div>
</div>
<div id="challenge-3-1" class="section level3">
<h3><span class="header-section-number">5.7.3</span> Challenge 3</h3>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="working-with-spatial-data-in-r.html#cb170-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb170-2"><a href="working-with-spatial-data-in-r.html#cb170-2"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> sample_raster, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> layer))<span class="op">+</span></span>
<span id="cb170-3"><a href="working-with-spatial-data-in-r.html#cb170-3"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>koala_vic, <span class="dt">size =</span> <span class="dv">2</span>, <span class="kw">aes</span>(<span class="dt">color =</span> sex), <span class="dt">show.legend =</span> <span class="st">&quot;point&quot;</span>)<span class="op">+</span></span>
<span id="cb170-4"><a href="working-with-spatial-data-in-r.html#cb170-4"></a><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">option =</span> <span class="st">&quot;D&quot;</span>) <span class="op">+</span></span>
<span id="cb170-5"><a href="working-with-spatial-data-in-r.html#cb170-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Longitude&quot;</span>, </span>
<span id="cb170-6"><a href="working-with-spatial-data-in-r.html#cb170-6"></a>       <span class="dt">y =</span> <span class="st">&quot;Latitude&quot;</span>, </span>
<span id="cb170-7"><a href="working-with-spatial-data-in-r.html#cb170-7"></a>       <span class="dt">fill =</span> <span class="st">&quot;Elevation&quot;</span>) <span class="op">+</span></span>
<span id="cb170-8"><a href="working-with-spatial-data-in-r.html#cb170-8"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">+</span></span>
<span id="cb170-9"><a href="working-with-spatial-data-in-r.html#cb170-9"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-to-linear-models-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="functions-loops-and-apply.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
